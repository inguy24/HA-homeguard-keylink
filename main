[
    {
        "id": "c403638dc6be311a",
        "type": "subflow",
        "name": "Process Fire Alarm Command Request",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 140,
                "wires": [
                    {
                        "id": "3ad4ce9386bbb2a4"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b545caad4b261d5e",
        "type": "change",
        "z": "c403638dc6be311a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "topic",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1360,
        "y": 80,
        "wires": [
            [
                "c932ede1651637fc"
            ]
        ]
    },
    {
        "id": "18bf787f60276764",
        "type": "subflow:41ebd12435392355",
        "z": "c403638dc6be311a",
        "name": "",
        "x": 2080,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "349be1e9623c2566",
        "type": "change",
        "z": "c403638dc6be311a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "clear",
                "tot": "str",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1840,
        "y": 80,
        "wires": [
            [
                "18bf787f60276764"
            ]
        ]
    },
    {
        "id": "3ad4ce9386bbb2a4",
        "type": "function",
        "z": "c403638dc6be311a",
        "name": "Check Sensor Status / Enable Alarm Sensor Groups",
        "func": "var groupSmokeEntities = global.get(\"homeassistant.homeAssistant.states['binary_sensor.alarm_smoke_group'].attributes.entity_id\");\nvar groupCOEntities = global.get(\"homeassistant.homeAssistant.states['binary_sensor.alarm_co_group'].attributes.entity_id\");\nvar checkSmoke = CheckSensorsReady(groupSmokeEntities);\nvar checkCO = CheckSensorsReady(groupCOEntities);\nvar notify = {};\nvar messageEntities = [];\n\nfunction CheckSensorsReady(obj) {\n    var check_entity;\n    var failed_entities = [];\n    var message_entities = [];\n    var checkFailed = false;\n\n    for (let index = 0; index < obj.length; index++) {\n        check_entity = global.get(\"homeassistant.homeAssistant.states['\" + obj[index] + \"'].state\");\n        if (check_entity != \"off\") {\n            let entity = obj[index];\n            let friendly_name = global.get(\"homeassistant.homeAssistant.states['\" + obj[index] + \"'].attributes.friendly_name\");\n            failed_entities.push(entity);\n            checkFailed = true;\n            message_entities.push(friendly_name);\n        };\n    };\n\n    return {\n        \"checkFailed\": checkFailed,\n        \"failed_entities\": failed_entities,\n        \"message_entities\": message_entities\n    };\n};\n\nfunction RemoveEntity(value, array) {\n    let modifiedArray = [];\n\n    const index = array.indexOf(value);\n    if (index > -1) { \n        modifiedArray = array.slice();\n        modifiedArray.splice(index, 1); \n    };\n\n    return modifiedArray;\n};\n\nfunction BypassSensors() {\n    if (checkSmoke.checkFailed == true || checkCO.checkFailed == true) {\n        if (checkSmoke.checkFailed == true) {\n            for (let index = 0; index < checkSmoke.failed_entities.length; index++) {\n                groupSmokeEntities = RemoveEntity(checkSmoke.failed_entities[index], groupSmokeEntities);\n            };\n        };\n        if (checkCO.checkFailed == true) {\n            for (let index = 0; index < checkCO.failed_entities.length; index++) {\n                groupCOEntities = RemoveEntity(checkCO.failed_entities[index], groupCOEntities);\n            };\n        };\n    };\n\n    return;\n};\n\nfunction StoreSensors(group) {\n    let group_id = group.object_id;\n    let sensor_groups = flow.get(\"$parent.sensor_groups\") || [];\n    let index_position = sensor_groups.findIndex(obj => {return obj.object_id === group_id});\n\n    if(index_position >= 0){\n        sensor_groups[index_position] = group;\n    } else {\n        sensor_groups.push(group);\n    };\n\n    flow.set (\"$parent.sensor_groups\",sensor_groups);\n\n    return;\n};\n\nmessageEntities = checkCO.message_entities.concat(checkSmoke.message_entities);\nmessageEntities = messageEntities.flat(Infinity);\n\n\nif (checkSmoke.checkFailed == true || checkCO.checkFailed == true) {\n\n    if (global.get(\"homeassistant.homeAssistant.states['switch.smoke_co_bypass_switch'].state\") == 'on') {\n        BypassSensors();\n\n        msg.payload = {\n            data: {\n                title: 'ALARM ERROR',\n                message: 'The fire alarm was armed with the following sensors bypassed: ' + messageEntities\n            }\n        };\n        msg.groups = [];\n        msg.groups[0] = {\n            \"data\": {\n                \"object_id\": \"alarm_active_smoke_sensor_group\",\n                \"entities\": groupSmokeEntities\n            }\n        };\n        StoreSensors(msg.groups[0].data);\n\n        msg.groups[1] = {\n            \"data\": {\n                \"object_id\": \"alarm_active_co_sensor_group\",\n                \"entities\": groupCOEntities\n            }\n        };\n        StoreSensors(msg.groups[1].data);\n\n        return [null, msg, null];\n\n    } else {\n\n        msg.payload = {\n            data: {\n                title: 'ALARM ERROR',\n                message: 'Fire alarm arming error. The fire alarm cannot arm due to the following sensor errors: ' + messageEntities\n            }\n        };\n        msg.groups = 'cancel';\n        return [null, null, msg];\n    };\n} else {\n\n    msg.groups = [];\n    msg.groups[0] = {\n        \"data\": {\n            \"object_id\": \"alarm_active_smoke_sensor_group\",\n            \"entities\": groupSmokeEntities\n        }\n    };\n    StoreSensors(msg.groups[0].data);\n\n    msg.groups[1] = {\n        \"data\": {\n            \"object_id\": \"alarm_active_co_sensor_group\",\n            \"entities\": groupCOEntities\n        }\n    };\n    StoreSensors(msg.groups[1].data);\n\n    return [msg, null, null];\n};\n",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 140,
        "wires": [
            [
                "468fbb041a1ba1ca"
            ],
            [
                "f909b54869c5d731"
            ],
            [
                "9f6ed2ed2ece0ff2"
            ]
        ]
    },
    {
        "id": "468fbb041a1ba1ca",
        "type": "function",
        "z": "c403638dc6be311a",
        "name": "Compose Message",
        "func": "msg.payload = 'The fire alarm system is armed.';\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 80,
        "wires": [
            [
                "8f3ecde3edf54918"
            ]
        ]
    },
    {
        "id": "c932ede1651637fc",
        "type": "subflow:a5da2b3babd8e8c2",
        "z": "c403638dc6be311a",
        "name": "",
        "x": 1600,
        "y": 80,
        "wires": [
            [
                "349be1e9623c2566"
            ]
        ]
    },
    {
        "id": "f909b54869c5d731",
        "type": "api-call-service",
        "z": "c403638dc6be311a",
        "name": "Notify Phones",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "notify.all_mobile_devices",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "notify",
        "service": "all_mobile_devices",
        "x": 680,
        "y": 140,
        "wires": [
            [
                "fb1030677c7737df"
            ]
        ]
    },
    {
        "id": "fb1030677c7737df",
        "type": "change",
        "z": "c403638dc6be311a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.data.message",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 140,
        "wires": [
            [
                "a178ba16bbc088aa"
            ]
        ]
    },
    {
        "id": "9f6ed2ed2ece0ff2",
        "type": "api-call-service",
        "z": "c403638dc6be311a",
        "name": "Notify Phones",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "notify.all_mobile_devices",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "notify",
        "service": "all_mobile_devices",
        "x": 680,
        "y": 200,
        "wires": [
            [
                "bebea92a2bbbebd2"
            ]
        ]
    },
    {
        "id": "bebea92a2bbbebd2",
        "type": "change",
        "z": "c403638dc6be311a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.data.message",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 200,
        "wires": [
            [
                "abd5b91687d2afc6"
            ]
        ]
    },
    {
        "id": "687d7d941998c476",
        "type": "change",
        "z": "c403638dc6be311a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "groups",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1360,
        "y": 140,
        "wires": [
            [
                "c0543ee1e1359ca8",
                "978b0723c8b502c7"
            ]
        ]
    },
    {
        "id": "457ac26cd8ab6736",
        "type": "api-call-service",
        "z": "c403638dc6be311a",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "group.set",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "group",
        "service": "set",
        "x": 1720,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "c0543ee1e1359ca8",
        "type": "split",
        "z": "c403638dc6be311a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1550,
        "y": 140,
        "wires": [
            [
                "457ac26cd8ab6736"
            ]
        ]
    },
    {
        "id": "90e08c7ca75864e1",
        "type": "ha-switch",
        "z": "c403638dc6be311a",
        "name": "Smoke-CO Bypass Switch",
        "version": 0,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 2,
        "entityConfig": "b7c17ff1aa290a8d",
        "enableInput": false,
        "outputOnStateChange": false,
        "outputProperties": [
            {
                "property": "outputType",
                "propertyType": "msg",
                "value": "state change",
                "valueType": "str"
            },
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 250,
        "y": 200,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "978b0723c8b502c7",
        "type": "change",
        "z": "c403638dc6be311a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1580,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "8f3ecde3edf54918",
        "type": "api-call-service",
        "z": "c403638dc6be311a",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 930,
        "y": 80,
        "wires": [
            [
                "207c0f068ad9e328"
            ]
        ]
    },
    {
        "id": "a178ba16bbc088aa",
        "type": "api-call-service",
        "z": "c403638dc6be311a",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1130,
        "y": 140,
        "wires": [
            [
                "207c0f068ad9e328"
            ]
        ]
    },
    {
        "id": "abd5b91687d2afc6",
        "type": "api-call-service",
        "z": "c403638dc6be311a",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1130,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "207c0f068ad9e328",
        "type": "junction",
        "z": "c403638dc6be311a",
        "x": 1260,
        "y": 80,
        "wires": [
            [
                "b545caad4b261d5e",
                "687d7d941998c476"
            ]
        ]
    },
    {
        "id": "b7c17ff1aa290a8d",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Smoke-CO Bypass Switch",
        "version": "6",
        "entityType": "switch",
        "haConfig": [
            {
                "property": "name",
                "value": "Smoke-CO Bypass Switch"
            },
            {
                "property": "icon",
                "value": ""
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "a5da2b3babd8e8c2",
        "type": "subflow",
        "name": "Set alarm_fire_status",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "e47cd5f2fcf9409d"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 640,
                "y": 140,
                "wires": [
                    {
                        "id": "86c12e87a20c99a9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e47cd5f2fcf9409d",
        "type": "ha-sensor",
        "z": "a5da2b3babd8e8c2",
        "name": "Set alarm_fire_status",
        "entityConfig": "e4c2dce934fdf096",
        "version": 0,
        "state": "payload",
        "stateType": "msg",
        "attributes": [],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 240,
        "y": 80,
        "wires": [
            [
                "86c12e87a20c99a9"
            ]
        ]
    },
    {
        "id": "86c12e87a20c99a9",
        "type": "change",
        "z": "a5da2b3babd8e8c2",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "alarm/fire/state",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "disarmed",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 80,
        "wires": [
            [
                "6c137e1081a9505d"
            ]
        ]
    },
    {
        "id": "6c137e1081a9505d",
        "type": "mqtt out",
        "z": "a5da2b3babd8e8c2",
        "name": "Broadcast MQTT Fire State",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "35c3b8b4dd3e8a28",
        "x": 740,
        "y": 80,
        "wires": []
    },
    {
        "id": "e4c2dce934fdf096",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Fire Status",
        "version": "6",
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Fire Status"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": true,
        "debugEnabled": false
    },
    {
        "id": "7dfee4f13b192105",
        "type": "subflow",
        "name": "Restore Lights",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "eedab9124a15d24f"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "eedab9124a15d24f",
        "type": "api-call-service",
        "z": "7dfee4f13b192105",
        "name": "Restore Lights",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "scene.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "scene.alarm_save_state"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "scene",
        "service": "turn_on",
        "x": 220,
        "y": 80,
        "wires": [
            [
                "a1294f6897152c44"
            ]
        ]
    },
    {
        "id": "a1294f6897152c44",
        "type": "change",
        "z": "7dfee4f13b192105",
        "name": "Set flow.$parent.lightsSaveExecuted FALSE",
        "rules": [
            {
                "t": "set",
                "p": "$parent.lightsSaveExecuted",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "16fb37dcb9a5b5b0",
        "type": "subflow",
        "name": "Restore Minis",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "097b3eac351de996"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "097b3eac351de996",
        "type": "api-call-service",
        "z": "16fb37dcb9a5b5b0",
        "name": "Restore Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "scene.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "scene.alarm_minis_save_state"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "scene",
        "service": "turn_on",
        "x": 220,
        "y": 80,
        "wires": [
            [
                "0a4451fc252fcf2f"
            ]
        ]
    },
    {
        "id": "0a4451fc252fcf2f",
        "type": "change",
        "z": "16fb37dcb9a5b5b0",
        "name": "Set flow.$parent.minisSaveExecuted FALSE",
        "rules": [
            {
                "t": "set",
                "p": "$parent.minisSaveExecuted",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "b32fde44b9ca4f89",
        "type": "subflow",
        "name": "Save Lights",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "9636a95c441ae202"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "ef6a106499747001",
        "type": "ha-get-entities",
        "z": "b32fde44b9ca4f89",
        "name": "Get Lights",
        "server": "cc16ce7d.d93d8",
        "version": 1,
        "rules": [
            {
                "property": "entity_id",
                "logic": "starts_with",
                "value": "light.",
                "valueType": "str"
            },
            {
                "property": "entity_id",
                "logic": "is_not",
                "value": "basic",
                "valueType": "re"
            },
            {
                "property": "entity_id",
                "logic": "is_not",
                "value": "_group",
                "valueType": "re"
            }
        ],
        "outputType": "split",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 870,
        "y": 80,
        "wires": [
            [
                "80da539b4a9d3a24"
            ]
        ]
    },
    {
        "id": "9ad5c1ec73935162",
        "type": "api-call-service",
        "z": "b32fde44b9ca4f89",
        "name": "Create Save Scene",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "scene.create",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "scene",
        "service": "create",
        "x": 1450,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "80da539b4a9d3a24",
        "type": "join",
        "z": "b32fde44b9ca4f89",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "2",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1050,
        "y": 80,
        "wires": [
            [
                "e31f7f317c09e8f2"
            ]
        ]
    },
    {
        "id": "e31f7f317c09e8f2",
        "type": "change",
        "z": "b32fde44b9ca4f89",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.data.scene_id",
                "pt": "msg",
                "to": "alarm_save_state",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.data.snapshot_entities",
                "pt": "msg",
                "to": "payload.entity_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 80,
        "wires": [
            [
                "9ad5c1ec73935162"
            ]
        ]
    },
    {
        "id": "9636a95c441ae202",
        "type": "switch",
        "z": "b32fde44b9ca4f89",
        "name": "Check flow.$parent.lightsSaveExecuted",
        "property": "$parent.lightsSaveExecuted",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 300,
        "y": 80,
        "wires": [
            [],
            [
                "337d0edc9db656a2"
            ]
        ]
    },
    {
        "id": "337d0edc9db656a2",
        "type": "change",
        "z": "b32fde44b9ca4f89",
        "name": "Set lightsSaveExecuted TRUE",
        "rules": [
            {
                "t": "set",
                "p": "$parent.lightsSaveExecuted",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 80,
        "wires": [
            [
                "ef6a106499747001"
            ]
        ]
    },
    {
        "id": "1c36d79f241f28fb",
        "type": "subflow",
        "name": "Save Minis States",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "294ac3f504fc2160"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "acb61cfaa4e9a3a8",
        "type": "ha-get-entities",
        "z": "1c36d79f241f28fb",
        "name": "Get Minis",
        "server": "cc16ce7d.d93d8",
        "version": 1,
        "rules": [
            {
                "property": "entity_id",
                "logic": "is",
                "value": "_mini",
                "valueType": "re"
            }
        ],
        "outputType": "split",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "minis",
        "outputResultsCount": 1,
        "x": 880,
        "y": 80,
        "wires": [
            [
                "5eec7d0350629741"
            ]
        ]
    },
    {
        "id": "5eec7d0350629741",
        "type": "join",
        "z": "1c36d79f241f28fb",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "2",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1050,
        "y": 80,
        "wires": [
            [
                "377fb6a66dd610c5"
            ]
        ]
    },
    {
        "id": "377fb6a66dd610c5",
        "type": "change",
        "z": "1c36d79f241f28fb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.data.scene_id",
                "pt": "msg",
                "to": "alarm_minis_save_state",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.data.snapshot_entities",
                "pt": "msg",
                "to": "payload.entity_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 80,
        "wires": [
            [
                "9e75719af78d3b37"
            ]
        ]
    },
    {
        "id": "9e75719af78d3b37",
        "type": "api-call-service",
        "z": "1c36d79f241f28fb",
        "name": "Create Save Scene",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "scene.create",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "scene",
        "service": "create",
        "x": 1470,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "294ac3f504fc2160",
        "type": "switch",
        "z": "1c36d79f241f28fb",
        "name": "Check flow.$parent.minisSaveExecuted",
        "property": "$parent.minisSaveExecuted",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 300,
        "y": 80,
        "wires": [
            [],
            [
                "c0db38b6f181778a"
            ]
        ]
    },
    {
        "id": "c0db38b6f181778a",
        "type": "change",
        "z": "1c36d79f241f28fb",
        "name": "Set minisSaveExecuted TRUE",
        "rules": [
            {
                "t": "set",
                "p": "$parent.minisSaveExecuted",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 80,
        "wires": [
            [
                "acb61cfaa4e9a3a8"
            ]
        ]
    },
    {
        "id": "4bcf46b11bf99871",
        "type": "subflow",
        "name": "Initiate Alarm Sequence",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 1020,
                "wires": [
                    {
                        "id": "6b813591375a5bd4"
                    },
                    {
                        "id": "a56c2e54299a3435"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7d45201ac2b111ae",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "Turn All Lights ON",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "light.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"transition\":1,\"kelvin\":5000,\"brightness_pct\":100}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "light",
        "service": "turn_on",
        "x": 1210,
        "y": 740,
        "wires": [
            [
                "b3d2d556418d3966"
            ]
        ]
    },
    {
        "id": "e8dd2127292ddde8",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "Set Scene",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "scene.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "{{payload}}"
        ],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "scene",
        "service": "turn_on",
        "x": 1650,
        "y": 740,
        "wires": [
            [
                "f1f637f6dcaa2ddf"
            ]
        ]
    },
    {
        "id": "f1f637f6dcaa2ddf",
        "type": "loop",
        "z": "4bcf46b11bf99871",
        "name": "",
        "kind": "fcnt",
        "count": "200",
        "initial": "1",
        "step": "1",
        "condition": "",
        "conditionType": "js",
        "when": "before",
        "enumeration": "enum",
        "enumerationType": "msg",
        "limit": "",
        "loopPayload": "loop-index",
        "finalPayload": "final-last",
        "x": 1870,
        "y": 740,
        "wires": [
            [],
            [
                "7b7c9e6e90cab3e8"
            ]
        ]
    },
    {
        "id": "cb4aa47c631f03cf",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "Flash Scene Lights",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "light.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "binary_sensor.balcony_light",
            "light.signify_netherlands_b_v_lct007_light_2",
            "light.signify_netherlands_b_v_lct011_light_2"
        ],
        "labelId": [],
        "data": "{\"flash\":\"long\"}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "light",
        "service": "turn_on",
        "x": 1870,
        "y": 860,
        "wires": [
            [
                "2067402a14a1e480"
            ]
        ]
    },
    {
        "id": "2067402a14a1e480",
        "type": "delay",
        "z": "4bcf46b11bf99871",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1840,
        "y": 920,
        "wires": [
            [
                "f1f637f6dcaa2ddf"
            ]
        ]
    },
    {
        "id": "148f33f41a062fae",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "Set Volume",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "media_player.volume_set",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "media_player.minis"
        ],
        "labelId": [],
        "data": "{\"volume_level\":\"1\"}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "media_player",
        "service": "volume_set",
        "x": 950,
        "y": 1020,
        "wires": [
            [
                "59cf230dda63f110"
            ]
        ]
    },
    {
        "id": "aea7afdd56b4e8aa",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "Play Klaxon",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "media_player.play_media",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "media_player.minis"
        ],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "media_player",
        "service": "play_media",
        "x": 1390,
        "y": 1200,
        "wires": [
            [
                "a2aa161360c86b3a"
            ]
        ]
    },
    {
        "id": "a2aa161360c86b3a",
        "type": "delay",
        "z": "4bcf46b11bf99871",
        "name": "",
        "pauseType": "delay",
        "timeout": "7",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1380,
        "y": 1260,
        "wires": [
            [
                "aa2dd414a54d66c8"
            ]
        ]
    },
    {
        "id": "80bc860553be82e1",
        "type": "looptimer",
        "z": "4bcf46b11bf99871",
        "duration": "18",
        "units": "Second",
        "maxloops": "120",
        "maxtimeout": "30",
        "maxtimeoutunits": "Minute",
        "name": "",
        "x": 1400,
        "y": 1020,
        "wires": [
            [
                "1364718345193ec1"
            ],
            []
        ]
    },
    {
        "id": "7b7c9e6e90cab3e8",
        "type": "api-current-state",
        "z": "4bcf46b11bf99871",
        "name": "Check armed_state DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "disarmed",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.alarm_armed_state",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1910,
        "y": 800,
        "wires": [
            [
                "dae9435dffdc6110"
            ],
            [
                "cb4aa47c631f03cf"
            ]
        ]
    },
    {
        "id": "1364718345193ec1",
        "type": "api-current-state",
        "z": "4bcf46b11bf99871",
        "name": "Check armed_state DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "disarmed",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.alarm_armed_state",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "STOP",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 1450,
        "y": 1080,
        "wires": [
            [
                "80bc860553be82e1"
            ],
            [
                "6717260b5dedc1e4"
            ]
        ]
    },
    {
        "id": "6b813591375a5bd4",
        "type": "function",
        "z": "4bcf46b11bf99871",
        "name": "Process Trigger",
        "func": "var spoken;\nvar notify = {};\nvar scene;\nvar responseType;\nvar siren;\nvar klaxon;\nvar alarm_method = [];\n\nswitch(msg.sensor_type){\n    case 'FIRE':\n        spoken = 'Attention! Attention! Smoke has been detected. Please exit the unit as quickly as possible.';\n        notify = {\n            \"title\": 'FIRE',\n            \"message\": 'The ' + msg.trigger.sensor + ' has detected smoke at ' + msg.trigger.time + '. The alarm has been sounded.',\n            \"data\": {\n                \"channel\": 'Alarm',\n                \"importance\": 'high',\n                \"persistence\": true,\n                \"tag\": 'Alarm'\n            }\n        };\n        scene = 'scene.fire_co';\n        responseType = 'fire';\n        siren = '5';\n        klaxon = \"https://homeassistant.shaneburkhardt.com:8123/local/media/tng_red_alert2.mp3\";\n        alarm_method = ['message','announce','lights','siren','noonlight','keypad'];\n        break;\n    case 'CARBON MONOXIDE':\n        spoken = 'Attention! Attention! Carbon monoxide has been detected. Please exit the unit as quickly as possible.';\n        notify = {\n            \"title\"     : 'CO ALARM',\n            \"message\"   : 'The ' + msg.trigger.sensor + ' has detected carbon monoxide (CO) at ' + msg.trigger.time + '. The alarm has been sounded.',\n            \"data\"      : {\n                \"channel\"       : 'Alarm',\n                \"importance\"    : 'high',\n                \"persistence\"   : true,\n                \"tag\"           : 'Alarm'\n            }\n        };\n        scene = 'scene.fire_co';  \n        responseType = 'fire';\n        siren = '5'; \n        klaxon = \"https://homeassistant.shaneburkhardt.com:8123/local/media/tng_red_alert2.mp3\";\n        alarm_method = ['message', 'announce', 'lights', 'siren', 'noonlight','keypad'];\n        break;\n    case 'INTRUDER':\n        spoken = 'Intruder Alert! Intruder Alert! The police have been summoned.';\n        notify = {\n            \"title\": 'INTRUDER ALERT',\n            \"message\": 'The ' + msg.trigger.sensor + ' was triggered at ' + msg.trigger.time + '. The alarm has been sounded.',\n            \"data\": {\n                \"channel\": 'Alarm',\n                \"importance\": 'high',\n                \"persistence\": true,\n                \"tag\": 'Alarm'\n            }\n        };\n        scene = 'scene.intruder';\n        responseType = 'police';\n        siren = '4';\n        klaxon = \"https://homeassistant.shaneburkhardt.com:8123/local/media/tng_red_alert2.mp3\";\n        alarm_method = ['message', 'announce', 'lights', 'siren', 'noonlight','keypad'];\n        break;\n    case 'PANIC':\n        alarm_method = ['noonlight'];\n        responseType = 'police';\n        break;\n    case 'LEAK':\n        alarm_method = ['message', 'announce'];\n        notify = {\n            \"title\": 'LEAK',\n            \"message\": 'The ' + msg.trigger.sensor + 'was triggered at ' + msg.trigger.time + '. Please check for a leak.',\n            \"data\": {\n                \"channel\": 'Alarm',\n                \"importance\": 'high',\n                \"persistence\": true,\n                \"tag\": 'Alarm'\n            }\n        };\n        spoken = 'Leak Alert! Leak Alert! The ' + msg.trigger.sensor + 'has detected a leak.';\n        klaxon = \"https://homeassistant.shaneburkhardt.com:8123/local/media/tng_red_alert2.mp3\";\n};\n\nmsg.parameters = {\n    \"spoken\" : spoken,\n    \"notify\" : notify,\n    \"scene\" : scene,\n    \"noonlight\" : {\n        \"service\" : responseType\n    },\n    \"siren\" : siren,\n    \"klaxon\" : klaxon\n};\n\nmsg.alarm_method = alarm_method;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 1020,
        "wires": [
            [
                "af2c6fcc2b6b4ae2",
                "ac776a2c7b5efb8e",
                "7924b52f345e6a61",
                "5559652294b1938a",
                "fe053ced96ed38e3",
                "7c72107c3c0b42df",
                "1b86dbf1413cb646"
            ]
        ]
    },
    {
        "id": "b3d2d556418d3966",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "parameters.scene",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1440,
        "y": 740,
        "wires": [
            [
                "e8dd2127292ddde8"
            ]
        ]
    },
    {
        "id": "cf42e87fc74d59ee",
        "type": "join",
        "z": "4bcf46b11bf99871",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "key": "payload",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "5",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 970,
        "y": 740,
        "wires": [
            [
                "a502e9d60358126d"
            ]
        ]
    },
    {
        "id": "dae9435dffdc6110",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "Send BREAK",
        "rules": [
            {
                "t": "set",
                "p": "command",
                "pt": "msg",
                "to": "break",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2180,
        "y": 800,
        "wires": [
            [
                "f1f637f6dcaa2ddf"
            ]
        ]
    },
    {
        "id": "a502e9d60358126d",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "data",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.data",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.data.entity_id",
                "pt": "msg",
                "to": "payload.entity_id",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1000,
        "y": 800,
        "wires": [
            [
                "99dc3ff70f59126d"
            ]
        ]
    },
    {
        "id": "984e46924519093f",
        "type": "ha-get-entities",
        "z": "4bcf46b11bf99871",
        "name": "Get Lights",
        "server": "cc16ce7d.d93d8",
        "version": 1,
        "rules": [
            {
                "property": "entity_id",
                "logic": "starts_with",
                "value": "light.",
                "valueType": "str"
            },
            {
                "property": "entity_id",
                "logic": "is_not",
                "value": "basic",
                "valueType": "re"
            },
            {
                "property": "entity_id",
                "logic": "is_not",
                "value": "_group",
                "valueType": "re"
            }
        ],
        "outputType": "split",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 790,
        "y": 740,
        "wires": [
            [
                "cf42e87fc74d59ee"
            ]
        ]
    },
    {
        "id": "c8f6f658b22abf63",
        "type": "comment",
        "z": "4bcf46b11bf99871",
        "name": "Notify Phones",
        "info": "",
        "x": 510,
        "y": 340,
        "wires": []
    },
    {
        "id": "2d5cc3d67503e2c1",
        "type": "comment",
        "z": "4bcf46b11bf99871",
        "name": "Turn on Lights",
        "info": "",
        "x": 510,
        "y": 680,
        "wires": []
    },
    {
        "id": "5a747eb39055bbb4",
        "type": "comment",
        "z": "4bcf46b11bf99871",
        "name": "Play Message on Minis",
        "info": "",
        "x": 540,
        "y": 960,
        "wires": []
    },
    {
        "id": "5b4861e9d528e2ad",
        "type": "comment",
        "z": "4bcf46b11bf99871",
        "name": "Send Notification to Noonlight Central Monitoring",
        "info": "",
        "x": 620,
        "y": 1400,
        "wires": []
    },
    {
        "id": "629e8fa08d1766c7",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.data",
                "pt": "msg",
                "to": "parameters.noonlight",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 1460,
        "wires": [
            [
                "59264ac6d5e87898"
            ]
        ]
    },
    {
        "id": "59cf230dda63f110",
        "type": "function",
        "z": "4bcf46b11bf99871",
        "name": "Compose Message",
        "func": "msg.payload = {\n    data : {\n        \"media_content_id\" : msg.parameters.klaxon,\n        \"media_content_type\" : \"audio/mp3\",\n        \"announce\" : \"true\"\n    }\n};\nmsg.payload2 = {\n    data : {\n        message : msg.parameters.spoken,\n        language : 'en-US',\n        options : {\n            voice : 'CoraNeural'\n        }\n    }\n};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 1020,
        "wires": [
            [
                "80bc860553be82e1"
            ]
        ]
    },
    {
        "id": "3007a6749c26866c",
        "type": "comment",
        "z": "4bcf46b11bf99871",
        "name": "Sound Siren",
        "info": "",
        "x": 510,
        "y": 1580,
        "wires": []
    },
    {
        "id": "59264ac6d5e87898",
        "type": "ha-switch",
        "z": "4bcf46b11bf99871",
        "name": "Security Central Monitoring ON",
        "version": 0,
        "debugenabled": false,
        "inputs": 1,
        "outputs": 2,
        "entityConfig": "fdb7f1b21519764a",
        "enableInput": true,
        "outputOnStateChange": false,
        "outputProperties": [
            {
                "property": "outputType",
                "propertyType": "msg",
                "value": "state change",
                "valueType": "str"
            },
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 1090,
        "y": 1460,
        "wires": [
            [
                "dcc708c40c5ef5cb"
            ],
            []
        ]
    },
    {
        "id": "69590e3a8b999638",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "siren.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "switch.alarm_siren"
        ],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "siren",
        "service": "turn_on",
        "x": 1230,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "3a63af14cf21a391",
        "type": "function",
        "z": "4bcf46b11bf99871",
        "name": "Compose Args",
        "func": "msg.payload = {\n    data : {\n        tone : msg.parameters.siren,\n        volume_level : '1',\n        duration : 1\n    }\n};\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 1640,
        "wires": [
            [
                "69590e3a8b999638"
            ]
        ]
    },
    {
        "id": "e8f56d3728103553",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "siren.turn_off",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "switch.alarm_siren"
        ],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "siren",
        "service": "turn_off",
        "x": 830,
        "y": 1980,
        "wires": [
            []
        ]
    },
    {
        "id": "aa2dd414a54d66c8",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "parameters.spoken",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 1320,
        "wires": [
            [
                "5c35e6a1cf6ffb3b"
            ]
        ]
    },
    {
        "id": "af2c6fcc2b6b4ae2",
        "type": "switch",
        "z": "4bcf46b11bf99871",
        "name": "alarm_method MESSAGE",
        "property": "alarm_method",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "message",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 550,
        "y": 400,
        "wires": [
            [
                "b32c609f727c76e7"
            ]
        ]
    },
    {
        "id": "ac776a2c7b5efb8e",
        "type": "switch",
        "z": "4bcf46b11bf99871",
        "name": "alarm_method LIGHTS",
        "property": "alarm_method",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "lights",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 550,
        "y": 740,
        "wires": [
            [
                "d2526dbc78c059c1",
                "984e46924519093f"
            ]
        ]
    },
    {
        "id": "7924b52f345e6a61",
        "type": "switch",
        "z": "4bcf46b11bf99871",
        "name": "alarm_method ANNOUNCE",
        "property": "alarm_method",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "announce",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 540,
        "y": 1020,
        "wires": [
            [
                "18292a582ac5124c",
                "f659cef0a6b4d3b6"
            ]
        ]
    },
    {
        "id": "5559652294b1938a",
        "type": "switch",
        "z": "4bcf46b11bf99871",
        "name": "alarm_method NOONLIGHT",
        "property": "alarm_method",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "noonlight",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 560,
        "y": 1460,
        "wires": [
            [
                "629e8fa08d1766c7"
            ]
        ]
    },
    {
        "id": "fe053ced96ed38e3",
        "type": "switch",
        "z": "4bcf46b11bf99871",
        "name": "alarm_method SIREN",
        "property": "alarm_method",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "siren",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 540,
        "y": 1640,
        "wires": [
            [
                "79ccf481f7d9238f"
            ]
        ]
    },
    {
        "id": "58a438cf52d20317",
        "type": "comment",
        "z": "4bcf46b11bf99871",
        "name": "Flash Keypads Triggered",
        "info": "",
        "x": 550,
        "y": 1200,
        "wires": []
    },
    {
        "id": "7c72107c3c0b42df",
        "type": "switch",
        "z": "4bcf46b11bf99871",
        "name": "alarm_method KEYPAD",
        "property": "alarm_method",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "keypad",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 550,
        "y": 1260,
        "wires": [
            [
                "5ccf81655d5cef11"
            ]
        ]
    },
    {
        "id": "18292a582ac5124c",
        "type": "subflow:1c36d79f241f28fb",
        "z": "4bcf46b11bf99871",
        "name": "Save Minis States",
        "x": 570,
        "y": 1080,
        "wires": []
    },
    {
        "id": "d2526dbc78c059c1",
        "type": "subflow:b32fde44b9ca4f89",
        "z": "4bcf46b11bf99871",
        "name": "",
        "x": 510,
        "y": 800,
        "wires": []
    },
    {
        "id": "99dc3ff70f59126d",
        "type": "delay",
        "z": "4bcf46b11bf99871",
        "name": "",
        "pauseType": "delay",
        "timeout": "6",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 980,
        "y": 860,
        "wires": [
            [
                "7d45201ac2b111ae"
            ]
        ]
    },
    {
        "id": "f659cef0a6b4d3b6",
        "type": "delay",
        "z": "4bcf46b11bf99871",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 780,
        "y": 1020,
        "wires": [
            [
                "148f33f41a062fae"
            ]
        ]
    },
    {
        "id": "f666ddd294595451",
        "type": "subflow:16fb37dcb9a5b5b0",
        "z": "4bcf46b11bf99871",
        "name": "",
        "x": 1020,
        "y": 1860,
        "wires": []
    },
    {
        "id": "5edf3c43bfea055d",
        "type": "subflow:7dfee4f13b192105",
        "z": "4bcf46b11bf99871",
        "name": "",
        "x": 1020,
        "y": 1920,
        "wires": []
    },
    {
        "id": "5ccf81655d5cef11",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "triggered",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 1260,
        "wires": [
            [
                "60c761edca021444"
            ]
        ]
    },
    {
        "id": "6717260b5dedc1e4",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.data.media_content_id",
                "pt": "msg",
                "to": "parameters.klaxon",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "payload.data.media_content_type",
                "pt": "msg",
                "to": "music",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.data.announce",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 1140,
        "wires": [
            [
                "aea7afdd56b4e8aa"
            ]
        ]
    },
    {
        "id": "b32c609f727c76e7",
        "type": "looptimer",
        "z": "4bcf46b11bf99871",
        "duration": "1",
        "units": "Minute",
        "maxloops": "120",
        "maxtimeout": "4",
        "maxtimeoutunits": "Hour",
        "name": "",
        "x": 800,
        "y": 400,
        "wires": [
            [
                "25ff239a97958e38"
            ],
            []
        ]
    },
    {
        "id": "25ff239a97958e38",
        "type": "api-current-state",
        "z": "4bcf46b11bf99871",
        "name": "Check armed_state DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "disarmed",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.alarm_armed_state",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "STOP",
                "valueType": "str"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 850,
        "y": 460,
        "wires": [
            [
                "b32c609f727c76e7"
            ],
            [
                "9e6935c67f4d69d5"
            ]
        ]
    },
    {
        "id": "79ccf481f7d9238f",
        "type": "ha-switch",
        "z": "4bcf46b11bf99871",
        "name": "Alarm Enable Siren",
        "version": 0,
        "debugenabled": false,
        "inputs": 1,
        "outputs": 2,
        "entityConfig": "9c7434d93be97b13",
        "enableInput": true,
        "outputOnStateChange": false,
        "outputProperties": [
            {
                "property": "outputType",
                "propertyType": "msg",
                "value": "state change",
                "valueType": "str"
            },
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 790,
        "y": 1640,
        "wires": [
            [
                "3a63af14cf21a391"
            ],
            []
        ]
    },
    {
        "id": "873dcb58992d2b1b",
        "type": "subflow:41ebd12435392355",
        "z": "4bcf46b11bf99871",
        "name": "",
        "x": 520,
        "y": 2100,
        "wires": [
            []
        ]
    },
    {
        "id": "a56c2e54299a3435",
        "type": "change",
        "z": "4bcf46b11bf99871",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "sensor_type",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 2100,
        "wires": [
            [
                "873dcb58992d2b1b"
            ]
        ]
    },
    {
        "id": "60c761edca021444",
        "type": "subflow:732236be6337edb5",
        "z": "4bcf46b11bf99871",
        "name": "",
        "x": 1040,
        "y": 1260,
        "wires": [
            []
        ]
    },
    {
        "id": "1b86dbf1413cb646",
        "type": "ha-wait-until",
        "z": "4bcf46b11bf99871",
        "name": "Wait until DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "entities": {
            "entity": [
                "sensor.alarm_armed_state"
            ],
            "substring": [],
            "regex": []
        },
        "property": "state",
        "comparator": "is",
        "value": "disarmed",
        "valueType": "str",
        "timeout": "30",
        "timeoutType": "num",
        "timeoutUnits": "minutes",
        "checkCurrentState": true,
        "blockInputOverrides": false,
        "outputProperties": [],
        "entityLocation": "data",
        "entityLocationType": "none",
        "x": 540,
        "y": 1860,
        "wires": [
            [
                "d60d5d6163b1d997"
            ],
            [
                "d60d5d6163b1d997"
            ]
        ]
    },
    {
        "id": "20e46b58ad2e2759",
        "type": "comment",
        "z": "4bcf46b11bf99871",
        "name": "Restore Lights/Minis on Disarm or Time Out",
        "info": "",
        "x": 610,
        "y": 1800,
        "wires": []
    },
    {
        "id": "9e6935c67f4d69d5",
        "type": "function",
        "z": "4bcf46b11bf99871",
        "name": "Compose Message",
        "func": "let message = msg.parameters.notify;\nmsg.notify = {};\nmsg.notify = message;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 520,
        "wires": [
            [
                "5f1ab2e444c13a81"
            ]
        ]
    },
    {
        "id": "5f1ab2e444c13a81",
        "type": "subflow:8e72be3f785145d5",
        "z": "4bcf46b11bf99871",
        "name": "",
        "x": 1031.7337646484375,
        "y": 522.7384033203125,
        "wires": [
            []
        ]
    },
    {
        "id": "999ae01c67f3b284",
        "type": "delay",
        "z": "4bcf46b11bf99871",
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 820,
        "y": 1860,
        "wires": [
            [
                "f666ddd294595451",
                "5edf3c43bfea055d"
            ]
        ]
    },
    {
        "id": "dcc708c40c5ef5cb",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "Noonlight Create Alarm",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "noonlight.create_alarm",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "noonlight",
        "service": "create_alarm",
        "x": 1390,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "5c35e6a1cf6ffb3b",
        "type": "api-call-service",
        "z": "4bcf46b11bf99871",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1410,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "d60d5d6163b1d997",
        "type": "junction",
        "z": "4bcf46b11bf99871",
        "x": 700,
        "y": 1860,
        "wires": [
            [
                "e8f56d3728103553",
                "999ae01c67f3b284"
            ]
        ]
    },
    {
        "id": "fdb7f1b21519764a",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "alarm_central_monitoring",
        "version": "6",
        "entityType": "switch",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Central Monitoring"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": "switch"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "9c7434d93be97b13",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Enable Siren",
        "version": "6",
        "entityType": "switch",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Enable Siren"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "174c2011475d038d",
        "type": "subflow",
        "name": "Alarm Process Trigger",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "4ef7e336f8e2a6e8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 380,
                "y": 80,
                "wires": [
                    {
                        "id": "4ef7e336f8e2a6e8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "4ef7e336f8e2a6e8",
        "type": "function",
        "z": "174c2011475d038d",
        "name": "function 2",
        "func": "function GetChangedGroupEntity(group, stateMatch){\n\n    var groupEntity = global.get(\"homeassistant.homeAssistant.states['\" + group + \"'].attributes.entity_id\");\n\n    for (let index = 0; index < groupEntity.length; index++) {\n        var entity = {};\n        entity.id = groupEntity[index];\n        entity.state = global.get(\"homeassistant.homeAssistant.states['\" + groupEntity[index] + \"'].state\");\n        entity.sensor = global.get(\"homeassistant.homeAssistant.states['\" + groupEntity[index] + \"'].attributes.friendly_name\");\n        entity.time = msg.data.new_state.last_changed;\n\n        if(entity.state == stateMatch){\n            return entity;\n        };\n\n    };\n};\n\nif(msg.sensor_type == 'INTRUDER'){\n    msg.entryExit = 'entry';\n    \n    if(msg.delay == true){\n        msg.delay = null;\n\n        switch(global.get(\"homeassistant.homeAssistant.states['sensor.alarm_armed_state'].state\")){\n            case ('armed_home') :\n                msg.trigger_group = 'home';\n                msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.alarm_home_entry_delay'].state\"));\n                break;\n            case ('armed_night') :\n                msg.trigger_group = 'night';\n                msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.alarm_night_entry_delay'].state\"));\n                break;\n            case ('armed_away') :\n                msg.trigger_group = 'away';\n                msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.alarm_away_entry_delay'].state\"));\n                break;\n            case ('triggered') :\n                msg.delay = 0;\n                break;\n            case ('disarmed') :\n                msg.trigger_group = 'disarm';\n                return null;\n        };\n    } else {\n        msg.delay = null;\n        msg.delay = 0;\n    };\n};\nif(msg.sensor_type == 'FIRE'){\n    msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.smoke_delay'].state\"));\n}\nif(msg.sensor_type == 'CARBON MONOXIDE'){\n    msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.co_delay'].state\"));\n}\nmsg.trigger = GetChangedGroupEntity(msg.topic, 'on');\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "8e72be3f785145d5",
        "type": "subflow",
        "name": "Phone Notify",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 90,
                "y": 80,
                "wires": [
                    {
                        "id": "f4fe7e8cfc130c1e"
                    },
                    {
                        "id": "113a60f022a8f806"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 410,
                "y": 160,
                "wires": [
                    {
                        "id": "113a60f022a8f806",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "8a2ccbe047211ccf",
        "type": "ha-api",
        "z": "8e72be3f785145d5",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 1,
        "debugenabled": false,
        "protocol": "websocket",
        "method": "get",
        "path": "",
        "data": "{\"type\":\"get_services\"}",
        "dataType": "json",
        "responseType": "json",
        "outputProperties": [
            {
                "property": "services",
                "propertyType": "msg",
                "value": "",
                "valueType": "results"
            }
        ],
        "x": 450,
        "y": 80,
        "wires": [
            [
                "ac7cc7098111365c"
            ]
        ]
    },
    {
        "id": "ac7cc7098111365c",
        "type": "function",
        "z": "8e72be3f785145d5",
        "name": "Filter Services",
        "func": "let output = Object.keys(msg.services.notify).filter(\n      (key)=>key.startsWith(\"mobile_app\"));\nlet arnoldHome = global.get(\"homeassistant.homeAssistant.states['device_tracker.arnolds_app_tracker'].state\");\n\nif(arnoldHome != 'home'){\n      let index = output.indexOf('mobile_app_arnolds_iphone');\n      output.splice(index, 1);\n}\n\nmsg.payload = {};\nmsg.payload = {\n      data : msg.notify\n};\nfor (let index = 0; index < output.length; index++) {\n      msg.payload.action = 'notify.' + output[index];\n      node.send(msg);\n};\nreturn;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 80,
        "wires": [
            [
                "0f889e217ecb2ecf"
            ]
        ]
    },
    {
        "id": "0f889e217ecb2ecf",
        "type": "api-call-service",
        "z": "8e72be3f785145d5",
        "name": "Notify Devices",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "notify",
        "service": "mobile_app_sm_s908u1",
        "x": 870,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "113a60f022a8f806",
        "type": "change",
        "z": "8e72be3f785145d5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "notify",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "f4fe7e8cfc130c1e",
        "type": "change",
        "z": "8e72be3f785145d5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 80,
        "wires": [
            [
                "8a2ccbe047211ccf"
            ]
        ]
    },
    {
        "id": "f33a1718373525b4",
        "type": "subflow",
        "name": "Keypad Entry/Exit Beep",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "1bbadff71bc8f6db"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "1bbadff71bc8f6db",
        "type": "function",
        "z": "f33a1718373525b4",
        "name": "Keypad Set Parameters",
        "func": "//  \nvar entities = [\"00:0d:6f:00:0c:fc:c8:69\",\"00:0d:6f:00:0b:80:cc:20\"];\nvar delay = msg.delay/1000;\nvar command = [];\nvar args = [];\nvar payload = [];\n\nswitch(msg.trigger_group){\n    case 'home': {\n        args = [[8, 0, 0, 0],[5, msg.delay, 1, 0]];\n        command = [4,4];\n        break;\n    }\n    case 'away': {\n        args = [[10, 0, 0, 0], [5, msg.delay, 1, 0]];\n        command = [4,4];\n        break;\n    }\n    case 'night': {\n        args = [[12, 0, 0, 0], [5, msg.delay, 1, 0]];\n        command = [4,4];\n        break;\n    }\n    case 'disarm': {\n        return;\n    }\n};\nfor (let index = 0; index < entities.length; index++) {   \n    for (let index2 = 0; index2 < args.length; index2++) {\n        payload.push({\n            ieee: entities[index],\n            cluster_id:1281,\n            endpoint_id:1,\n            cluster_type:\"out\",\n            command_type:\"client\",\n            \"command\":command[index2],\n            \"args\":args[index2]\n        });\n    };\n};\n\nmsg.payload = payload;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 80,
        "wires": [
            [
                "608d60af5308db1c"
            ]
        ]
    },
    {
        "id": "7bfff84fc109d28b",
        "type": "split",
        "z": "f33a1718373525b4",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1030,
        "y": 80,
        "wires": [
            [
                "3a55bddb783e51e1"
            ]
        ]
    },
    {
        "id": "5d3a1999a7346926",
        "type": "api-call-service",
        "z": "f33a1718373525b4",
        "name": "Call Keypads",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1210,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "3a55bddb783e51e1",
        "type": "change",
        "z": "f33a1718373525b4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.data",
                "pt": "msg",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 140,
        "wires": [
            [
                "1155a9b09e147517"
            ]
        ]
    },
    {
        "id": "1155a9b09e147517",
        "type": "delay",
        "z": "f33a1718373525b4",
        "name": "",
        "pauseType": "delay",
        "timeout": "150",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1010,
        "y": 200,
        "wires": [
            [
                "5d3a1999a7346926"
            ]
        ]
    },
    {
        "id": "608d60af5308db1c",
        "type": "switch",
        "z": "f33a1718373525b4",
        "name": "Check msg.delay > 0",
        "property": "delay",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 520,
        "y": 80,
        "wires": [
            [
                "33b9a4ddee47782d"
            ]
        ]
    },
    {
        "id": "33b9a4ddee47782d",
        "type": "change",
        "z": "f33a1718373525b4",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload.service",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 80,
        "wires": [
            [
                "7bfff84fc109d28b"
            ]
        ]
    },
    {
        "id": "732236be6337edb5",
        "type": "subflow",
        "name": "Set Alarm Armed State",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 100,
                "wires": [
                    {
                        "id": "c3d8b859a90309bc"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 660,
                "y": 60,
                "wires": [
                    {
                        "id": "21a5e28c0db28cb5",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c3d8b859a90309bc",
        "type": "ha-sensor",
        "z": "732236be6337edb5",
        "name": "Set alarm_armed_state",
        "entityConfig": "c19f7044f362db28",
        "version": 0,
        "state": "payload",
        "stateType": "msg",
        "attributes": [
            {
                "property": "changed_by",
                "value": "pin_name",
                "valueType": "msg"
            },
            {
                "property": "command_request",
                "value": "homeassistant.homeAssistant.states[\"sensor.alarm_command_request\"].state",
                "valueType": "global"
            }
        ],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 270,
        "y": 100,
        "wires": [
            [
                "21a5e28c0db28cb5"
            ]
        ]
    },
    {
        "id": "21a5e28c0db28cb5",
        "type": "change",
        "z": "732236be6337edb5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "alarm/security/state",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 100,
        "wires": [
            [
                "f0fdf425b63ffb52"
            ]
        ]
    },
    {
        "id": "f0fdf425b63ffb52",
        "type": "mqtt out",
        "z": "732236be6337edb5",
        "name": "Broadcast MQTT Security State Change",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "35c3b8b4dd3e8a28",
        "x": 800,
        "y": 140,
        "wires": []
    },
    {
        "id": "c19f7044f362db28",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "alarm_armed_state",
        "version": "6",
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Armed State"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": true,
        "debugEnabled": false
    },
    {
        "id": "35c3b8b4dd3e8a28",
        "type": "mqtt-broker",
        "name": "homeassistant",
        "broker": "homeassistant",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "5",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "a90b3a670eb5e15a",
        "type": "subflow",
        "name": "Entry/Exit Delay",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 220,
                "wires": [
                    {
                        "id": "3a10467ededa4270"
                    },
                    {
                        "id": "f32a44fd79a09865"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 280,
                "wires": [
                    {
                        "id": "15b56af64b4ff2e1",
                        "port": 1
                    },
                    {
                        "id": "cdd63aae3c4ed05c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "15b56af64b4ff2e1",
        "type": "trigger",
        "z": "a90b3a670eb5e15a",
        "name": "Delay",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "1",
        "extend": false,
        "overrideDelay": true,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 2,
        "x": 730,
        "y": 220,
        "wires": [
            [
                "bbc715ae75aa7830",
                "f489897a12e0fa3c"
            ],
            []
        ]
    },
    {
        "id": "d5a0fdfc042f2717",
        "type": "function",
        "z": "a90b3a670eb5e15a",
        "name": "Compose Message",
        "func": "msg.timeLeft = msg.timeLeft - 20;\nif(msg.entryExit == 'entry'){\n    msg.payload = 'The alarm will sound in ' + msg.timeLeft + ' seconds. Please disarm.';\n} else {\n    msg.payload = 'The alarm system will arm in ' + msg.timeLeft + ' seconds. Please exit the unit now.';\n};\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1750,
        "y": 220,
        "wires": [
            [
                "7315eb8d14022842",
                "d627828503bbafaf"
            ]
        ]
    },
    {
        "id": "7315eb8d14022842",
        "type": "loop",
        "z": "a90b3a670eb5e15a",
        "name": "",
        "kind": "fcnt",
        "count": "",
        "initial": "1",
        "step": "1",
        "condition": "'disarmed' = $globalContext(\"homeassistant.homeAssistant.states'input_select.alarm_armed_state'.state\")",
        "conditionType": "jsonata",
        "when": "before",
        "enumeration": "enum",
        "enumerationType": "msg",
        "limit": "",
        "loopPayload": "loop-index",
        "finalPayload": "final-count",
        "x": 1330,
        "y": 220,
        "wires": [
            [],
            [
                "cf00d97cb7381a8b"
            ]
        ]
    },
    {
        "id": "bbc715ae75aa7830",
        "type": "change",
        "z": "a90b3a670eb5e15a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "timeLeft",
                "pt": "msg",
                "to": "msg.delay / 1000",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 220,
        "wires": [
            [
                "945f0e5a6b2ff5ec"
            ]
        ]
    },
    {
        "id": "945f0e5a6b2ff5ec",
        "type": "function",
        "z": "a90b3a670eb5e15a",
        "name": "Set Loops",
        "func": "msg.count = Math.floor(msg.timeLeft/20) - 1;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 220,
        "wires": [
            [
                "7315eb8d14022842"
            ]
        ]
    },
    {
        "id": "cf00d97cb7381a8b",
        "type": "delay",
        "z": "a90b3a670eb5e15a",
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1540,
        "y": 220,
        "wires": [
            [
                "d5a0fdfc042f2717"
            ]
        ]
    },
    {
        "id": "3a10467ededa4270",
        "type": "change",
        "z": "a90b3a670eb5e15a",
        "name": "Convert Delay",
        "rules": [
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "msg.delay * 1000",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 220,
        "wires": [
            [
                "33eb68f057c7ed2e"
            ]
        ]
    },
    {
        "id": "33eb68f057c7ed2e",
        "type": "switch",
        "z": "a90b3a670eb5e15a",
        "name": "Check Delay > 0",
        "property": "delay",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 520,
        "y": 220,
        "wires": [
            [
                "15b56af64b4ff2e1"
            ],
            [
                "cdd63aae3c4ed05c"
            ]
        ]
    },
    {
        "id": "dc1ede7d39fd880f",
        "type": "ha-wait-until",
        "z": "a90b3a670eb5e15a",
        "name": "Wait until armed_state DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "entities": {
            "entity": [
                "sensor.alarm_armed_state"
            ],
            "substring": [],
            "regex": []
        },
        "property": "state",
        "comparator": "is",
        "value": "disarmed",
        "valueType": "str",
        "timeout": "500",
        "timeoutType": "num",
        "timeoutUnits": "seconds",
        "checkCurrentState": true,
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "reset",
                "propertyType": "msg",
                "value": "true",
                "valueType": "bool"
            },
            {
                "property": "command",
                "propertyType": "msg",
                "value": "break",
                "valueType": "str"
            }
        ],
        "entityLocation": "data",
        "entityLocationType": "none",
        "x": 1120,
        "y": 160,
        "wires": [
            [
                "cf00d97cb7381a8b",
                "15b56af64b4ff2e1"
            ],
            []
        ]
    },
    {
        "id": "f489897a12e0fa3c",
        "type": "delay",
        "z": "a90b3a670eb5e15a",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 880,
        "y": 160,
        "wires": [
            [
                "dc1ede7d39fd880f"
            ]
        ]
    },
    {
        "id": "cdd63aae3c4ed05c",
        "type": "change",
        "z": "a90b3a670eb5e15a",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "reset",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "f32a44fd79a09865",
        "type": "debug",
        "z": "a90b3a670eb5e15a",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 300,
        "y": 300,
        "wires": []
    },
    {
        "id": "d627828503bbafaf",
        "type": "api-call-service",
        "z": "a90b3a670eb5e15a",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1990,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "41ebd12435392355",
        "type": "subflow",
        "name": "Set alarm_type_state",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "6b9dd88ef4f30ae1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 420,
                "y": 80,
                "wires": [
                    {
                        "id": "6b9dd88ef4f30ae1",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "6b9dd88ef4f30ae1",
        "type": "ha-sensor",
        "z": "41ebd12435392355",
        "name": "Set alarm_type_state",
        "entityConfig": "f78ee004d985ccf3",
        "version": 0,
        "state": "payload",
        "stateType": "msg",
        "attributes": [
            {
                "property": "trigger_info",
                "value": "trigger_info",
                "valueType": "msg"
            }
        ],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 240,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "f78ee004d985ccf3",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "alarm_type_state",
        "version": "6",
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Type State"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": true,
        "debugEnabled": false
    },
    {
        "id": "4071dc9a91cae7dd",
        "type": "subflow",
        "name": "Process Alarm Command Request",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 500,
                "wires": [
                    {
                        "id": "a2c8ba54a2e839c2"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "86f9e740d572b956",
        "type": "function",
        "z": "4071dc9a91cae7dd",
        "name": "Set Parameters",
        "func": "msg.entryExit = 'exit';\nmsg.payload2 = {};\nmsg.get_entities = {};\n\nif(msg.payload != 'disarm' && global.get(\"homeassistant.homeAssistant.states['sensor.alarm_type_state'].state\") != 'clear'){\n    return [null,null,msg];\n} else {\n    switch(msg.payload){\n        case ('arm_night') :\n            msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.alarm_night_exit_delay'].state\")),\n            msg.trigger_group = 'night';\n            msg.payload2 = {\n                action : 'alarm_control_panel.alarm_arm_night'\n            };   \n            msg.payload3 = 'armed_night';\n            msg.get_entities = {\n                delayGroup: \"binary_sensor.alarm_night_sensors\",\n                instantGroup: \"binary_sensor.alarm_night_instant_group\",\n            };\n            return [null,msg,null];\n            break;\n        case ('arm_home') :\n            msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.alarm_home_exit_delay'].state\")),\n            msg.trigger_group = 'home';\n            msg.payload2 = {\n                action : 'alarm_control_panel.alarm_arm_home'\n            };           \n            msg.payload3 = 'armed_home';\n            msg.get_entities = {\n                delayGroup: \"binary_sensor.alarm_home_sensors\",\n                instantGroup: \"binary_sensor.alarm_home_instant_group\",\n            };\n            return [null,msg,null];\n            break;\n        case ('arm_away') :\n            msg.delay = Number(global.get(\"homeassistant.homeAssistant.states['number.alarm_away_exit_delay'].state\")),\n            msg.trigger_group = 'away';\n            msg.payload2 = {\n                action : 'alarm_control_panel.alarm_arm_away'\n            };           \n            msg.payload3 = 'armed_away';\n            msg.get_entities = {\n                delayGroup : \"binary_sensor.alarm_away_sensors\",\n                instantGroup : \"binary_sensor.alarm_away_instant_group\",\n                };\n            return [null,msg,null];\n            break;\n        case ('disarm') :\n            msg.payload = 'disarmed';\n            msg.delay = 0;\n            msg.trigger_group = 'disarm';\n            msg.reset = true;\n            msg.payload2 = {\n                action : 'alarm_control_panel.alarm_disarm',\n                data : {\n                    code : '1234'\n                }\n            };\n            msg.payload3 = 'disarmed';\n            return [msg,null,null];\n    };\n};",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 500,
        "wires": [
            [
                "6b15818fb433a9ce",
                "137ca15d23069228"
            ],
            [
                "95c16ff76970ca1d"
            ],
            [
                "e61876679f09f2be"
            ]
        ]
    },
    {
        "id": "820f080f18f267de",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload3",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 560,
        "wires": [
            [
                "a92225cb1614dcbc"
            ]
        ]
    },
    {
        "id": "18950f47b17c6c91",
        "type": "function",
        "z": "4071dc9a91cae7dd",
        "name": "Compose Message",
        "func": "var message = msg.payload3.replace(\"_\",\" \");\nmsg.payload = 'The security system is ' + message;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1910,
        "y": 680,
        "wires": [
            [
                "72ce14ccddaa2cf1"
            ]
        ]
    },
    {
        "id": "a2c8ba54a2e839c2",
        "type": "api-current-state",
        "z": "4071dc9a91cae7dd",
        "name": "Check alarm_master_status ARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "armed_home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.alarm_master_status",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 350,
        "y": 500,
        "wires": [
            [
                "86f9e740d572b956"
            ],
            []
        ]
    },
    {
        "id": "95c16ff76970ca1d",
        "type": "function",
        "z": "4071dc9a91cae7dd",
        "name": "Check Sensor States / Enable Alarm Sensor Groups",
        "func": "let groupInstantEntities = [];\nlet groupDelayEntities = [];\nlet checkInstant = {};\nlet checkDelay = {};\nlet notify = {};\nlet messageEntities = [];\nlet bypassedarrays = {};\n\nfunction CheckSensorsReady( obj ) {    \n    let check_entity;\n    let failed_entities = [];\n    let message_entities = [];\n    let checkFailed = false;\n\n    for (let index = 0; index < obj.length; index++) {\n        check_entity = global.get(\"homeassistant.homeAssistant.states['\" + obj[index] + \"'].state\");\n        if(check_entity != \"off\"){\n            let entity = obj[index];\n            let friendly_name = global.get(\"homeassistant.homeAssistant.states['\" + obj[index] + \"'].attributes.friendly_name\");\n            failed_entities.push(entity);\n            checkFailed = true;\n            message_entities.push(friendly_name);\n        };\n    };\n\n    return {\n        \"checkFailed\" : checkFailed,\n        \"failed_entities\" : failed_entities,\n        \"message_entities\" : message_entities\n    };\n};\n\nfunction RemoveEntity( value , array ) {\n    let modifiedArray = [];\n    \n    const index = array.indexOf(value);\n    if (index > -1) { \n        modifiedArray = array.slice();\n        modifiedArray.splice(index, 1); \n    };\n\n    return modifiedArray;\n};\n\nfunction BypassSensors(){\n    if(checkInstant.checkFailed == true || checkDelay.checkFailed == true){\n        if(checkInstant.checkFailed == true){\n            for (let index = 0; index < checkInstant.failed_entities.length; index++) {\n                groupInstantEntities = RemoveEntity(checkInstant.failed_entities[index], groupInstantEntities); \n            };\n        };\n        if (checkDelay.checkFailed == true) {\n            for (let index = 0; index < checkDelay.failed_entities.length; index++) {\n                groupDelayEntities = RemoveEntity(checkDelay.failed_entities[index], groupDelayEntities);\n            };\n        };\n    };\n};\n\nfunction StoreSensors(group) {\n    let group_id = group.object_id;\n    let sensor_groups = flow.get(\"$parent.sensor_groups\") || [];\n    let index_position = sensor_groups.findIndex(obj => { return obj.object_id === group_id });\n\n    if (index_position >= 0) {\n        sensor_groups[index_position] = group;\n    } else {\n        sensor_groups.push(group);\n    };\n\n    flow.set(\"$parent.sensor_groups\", sensor_groups);\n\n    return;\n};\n\ngroupInstantEntities = global.get(\"homeassistant.homeAssistant.states['\" + msg.get_entities.instantGroup + \"'].attributes.entity_id\");\ngroupDelayEntities = global.get(\"homeassistant.homeAssistant.states['\" + msg.get_entities.delayGroup + \"'].attributes.entity_id\");\ncheckInstant = CheckSensorsReady(groupInstantEntities);\ncheckDelay = CheckSensorsReady(groupDelayEntities);\nmessageEntities = checkDelay.message_entities.concat(checkInstant.message_entities);\nmessageEntities = messageEntities.flat(Infinity);\n\nif (checkInstant.checkFailed == true || checkDelay.checkFailed == true) {\n    if(global.get(\"homeassistant.homeAssistant.states['switch.alarm_bypass_enable'].state\") == 'on'){\n        let arm_type = msg.payload3.replace(\"_\", \" \");\n        \n        BypassSensors();\n        msg.notify = {\n            title: 'ALARM BYPASS',\n            message: 'The alarm was ' + arm_type + ' with the following sensors bypassed: ' + messageEntities\n        };\n        msg.groups = [];\n        msg.groups[0] = { \n            \"data\" : {     \n                \"object_id\": \"alarm_active_instant_sensor_group\", \n                \"entities\": groupInstantEntities\n            }\n        };\n        StoreSensors (msg.groups[0].data);\n        msg.groups[1] = {\n            \"data\": {\n                \"object_id\": \"alarm_active_delay_sensor_group\",\n                \"entities\": groupDelayEntities\n            }\n        };\n        StoreSensors (msg.groups[1].data);\n        return [msg, null];\n    } else {\n        msg.notify = {\n            title: 'ALARM ERROR',\n            message: 'Alarm arming error. The alarm cannot arm due to the following sensor errors: ' + messageEntities\n        };\n        msg.groups = 'cancel';\n        return [null, msg];\n    };\n} else {\n    msg.groups = [];\n    msg.groups[0] = { \n        \"data\" : {     \n            \"object_id\": \"alarm_active_instant_sensor_group\", \n            \"entities\": groupInstantEntities\n        }\n    };\n    StoreSensors (msg.groups[0].data);\n    msg.groups[1] = {\n        \"data\": {\n            \"object_id\": \"alarm_active_delay_sensor_group\",\n            \"entities\": groupDelayEntities\n        }\n    }; \n    StoreSensors (msg.groups[1].data);\n    return [msg, null];      \n};",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 760,
        "wires": [
            [
                "86930bf56c7bb4c1"
            ],
            [
                "49fc254100ee9204",
                "a35a93dcc648d338"
            ]
        ]
    },
    {
        "id": "96c593435fc6fa16",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1650,
        "y": 1100,
        "wires": [
            [
                "46fb1163826a7a07"
            ]
        ]
    },
    {
        "id": "1b9a3d48e1e23a91",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1650,
        "y": 1160,
        "wires": [
            [
                "0d96cde9e855c4fb"
            ]
        ]
    },
    {
        "id": "46fb1163826a7a07",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1930,
        "y": 1100,
        "wires": [
            [
                "eb3dd634e09b4834"
            ]
        ]
    },
    {
        "id": "0d96cde9e855c4fb",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1930,
        "y": 1160,
        "wires": [
            [
                "f652d584ed97c4ab"
            ]
        ]
    },
    {
        "id": "eb3dd634e09b4834",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 2210,
        "y": 1100,
        "wires": [
            [
                "cc1a7502b8246109"
            ]
        ]
    },
    {
        "id": "f652d584ed97c4ab",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 2210,
        "y": 1160,
        "wires": [
            [
                "528ff77a57e608bd"
            ]
        ]
    },
    {
        "id": "cc1a7502b8246109",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 2490,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "528ff77a57e608bd",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 2490,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "82c4fb725f45b831",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "groups",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 860,
        "wires": [
            [
                "7bf036b4acd30d35"
            ]
        ]
    },
    {
        "id": "bd187bf2b8f2af48",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "group.set",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "group",
        "service": "set",
        "x": 1760,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "7bf036b4acd30d35",
        "type": "split",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1590,
        "y": 860,
        "wires": [
            [
                "bd187bf2b8f2af48"
            ]
        ]
    },
    {
        "id": "49fc254100ee9204",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 1120,
        "wires": [
            [
                "96c593435fc6fa16",
                "1b9a3d48e1e23a91"
            ]
        ]
    },
    {
        "id": "2566dd5cab631c7a",
        "type": "subflow:41ebd12435392355",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1120,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "76c48d898197fa06",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload2",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1140,
        "y": 320,
        "wires": [
            [
                "b6eaf28fb2039744"
            ]
        ]
    },
    {
        "id": "24d3a5f0abd80b53",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload3",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1560,
        "y": 320,
        "wires": [
            [
                "b3ff50439536c88d"
            ]
        ]
    },
    {
        "id": "6b15818fb433a9ce",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "clear",
                "tot": "str",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 200,
        "wires": [
            [
                "2566dd5cab631c7a"
            ]
        ]
    },
    {
        "id": "91ff92a6cf90d892",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.message",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1598.2662353515625,
        "y": 1277.2615966796875,
        "wires": [
            [
                "f4d4327e2ee82b95"
            ]
        ]
    },
    {
        "id": "b3ff50439536c88d",
        "type": "function",
        "z": "4071dc9a91cae7dd",
        "name": "Compose Message",
        "func": "var message = msg.payload.replace(\"_\",\" \");\nmsg.payload = 'The security system is ' + message;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1790,
        "y": 320,
        "wires": [
            [
                "f29a3dc14213af39"
            ]
        ]
    },
    {
        "id": "cc7231d50f710eb0",
        "type": "ha-switch",
        "z": "4071dc9a91cae7dd",
        "name": "Alarm  Bypass Enable",
        "version": 0,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 2,
        "entityConfig": "b1a93b81b91f0ac1",
        "enableInput": false,
        "outputOnStateChange": false,
        "outputProperties": [
            {
                "property": "outputType",
                "propertyType": "msg",
                "value": "state change",
                "valueType": "str"
            },
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            }
        ],
        "x": 300,
        "y": 580,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "38296e1bcd7eed35",
        "type": "switch",
        "z": "4071dc9a91cae7dd",
        "name": "Check If ALARM ERROR",
        "property": "notify.title",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ALARM ERROR",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ALARM BYPASS",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1650,
        "y": 620,
        "wires": [
            [
                "051234a534ea39e4"
            ],
            [
                "051234a534ea39e4"
            ],
            [
                "18950f47b17c6c91"
            ]
        ]
    },
    {
        "id": "a68b3407abec99cf",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload.title",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.message",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2098.2662353515625,
        "y": 617.2615966796875,
        "wires": [
            [
                "9b94a1d1a137aecc"
            ]
        ]
    },
    {
        "id": "89f960674cfb01d9",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "jsonata",
                "dc": true
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload2",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 740,
        "wires": [
            [
                "39c2556a0286f7c1"
            ]
        ]
    },
    {
        "id": "d6ecbccd37980f85",
        "type": "subflow:a90b3a670eb5e15a",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1400,
        "y": 640,
        "wires": [
            [
                "820f080f18f267de",
                "38296e1bcd7eed35",
                "89f960674cfb01d9"
            ]
        ]
    },
    {
        "id": "137ca15d23069228",
        "type": "subflow:732236be6337edb5",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 900,
        "y": 320,
        "wires": [
            [
                "76c48d898197fa06"
            ]
        ]
    },
    {
        "id": "a92225cb1614dcbc",
        "type": "subflow:732236be6337edb5",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1860,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "ae4a92c448e27e98",
        "type": "subflow:732236be6337edb5",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1640,
        "y": 440,
        "wires": [
            [
                "cbcd4d397318faa1"
            ]
        ]
    },
    {
        "id": "bfb589dfac46d06d",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "arming",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 440,
        "wires": [
            [
                "ae4a92c448e27e98"
            ]
        ]
    },
    {
        "id": "cbcd4d397318faa1",
        "type": "subflow:f33a1718373525b4",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1910,
        "y": 440,
        "wires": []
    },
    {
        "id": "c527cb3d34c08cf9",
        "type": "switch",
        "z": "4071dc9a91cae7dd",
        "name": "Check msg.delay > 0",
        "property": "delay",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1420,
        "y": 980,
        "wires": [
            [
                "9a530dd3d209ca78"
            ]
        ]
    },
    {
        "id": "9a530dd3d209ca78",
        "type": "function",
        "z": "4071dc9a91cae7dd",
        "name": "Compose Message",
        "func": "msg.payload = 'The security system is arming ' + msg.trigger_group;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1670,
        "y": 980,
        "wires": [
            [
                "cb74e3fd2f0b0491"
            ]
        ]
    },
    {
        "id": "34721a3cd36a6852",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Set alarm_type_state CLEAR",
        "info": "",
        "x": 920,
        "y": 140,
        "wires": []
    },
    {
        "id": "04596e40f9e11168",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Set alarm_armed_state DISARMED / Set Keypads DISARMED /  Announce DISARMED",
        "info": "",
        "x": 1100,
        "y": 260,
        "wires": []
    },
    {
        "id": "92fb9811cbd217b2",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Set alarm_armed_state ARMING / Execute Keypad Beeps",
        "info": "",
        "x": 1530,
        "y": 380,
        "wires": []
    },
    {
        "id": "490366ac1ba81352",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Initiate Exit Delay / Set Final alarm_armed_state / Announce and Notify Status / Set Keypad Status",
        "info": "",
        "x": 1660,
        "y": 500,
        "wires": []
    },
    {
        "id": "6c327127feecc385",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Set Active Sensor Groups",
        "info": "",
        "x": 1430,
        "y": 800,
        "wires": []
    },
    {
        "id": "ed900119d0972126",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Announce Arming Intention",
        "info": "",
        "x": 1430,
        "y": 920,
        "wires": []
    },
    {
        "id": "1e6264ba85fc49fe",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Error Beeps",
        "info": "",
        "x": 1410,
        "y": 1040,
        "wires": []
    },
    {
        "id": "d5e0e03dc4a3bdc1",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Announce Error / Notify Error",
        "info": "",
        "x": 1440,
        "y": 1220,
        "wires": []
    },
    {
        "id": "e5f759805b849711",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.message",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1318.2662353515625,
        "y": 1397.2615966796875,
        "wires": [
            [
                "a22f5432ea0fd90e"
            ]
        ]
    },
    {
        "id": "7fa1d5f375f69b42",
        "type": "comment",
        "z": "4071dc9a91cae7dd",
        "name": "Notify Alarm Error - Alarm in triggered state",
        "info": "",
        "x": 980,
        "y": 1340,
        "wires": []
    },
    {
        "id": "601fe3933aa3f440",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "notify",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "notify",
                "pt": "msg",
                "to": "{\"data\":{\"title\":\"ALARM ERROR\",\"message\":\"Please disarm the alarm to reset the system before re-arming.\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 1400,
        "wires": [
            [
                "535d2084d769c5e9"
            ]
        ]
    },
    {
        "id": "99416f28d4419737",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1150,
        "y": 1460,
        "wires": [
            [
                "cd65cd66458e34b1"
            ]
        ]
    },
    {
        "id": "181932290653e8e2",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1150,
        "y": 1520,
        "wires": [
            [
                "acf1154626c1be60"
            ]
        ]
    },
    {
        "id": "cd65cd66458e34b1",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1430,
        "y": 1460,
        "wires": [
            [
                "7ef0ad6f4a912542"
            ]
        ]
    },
    {
        "id": "acf1154626c1be60",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1430,
        "y": 1520,
        "wires": [
            [
                "150c32928314b653"
            ]
        ]
    },
    {
        "id": "7ef0ad6f4a912542",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1710,
        "y": 1460,
        "wires": [
            [
                "5cf5183ed2f95121"
            ]
        ]
    },
    {
        "id": "150c32928314b653",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1710,
        "y": 1520,
        "wires": [
            [
                "a6a9cff3adb40bec"
            ]
        ]
    },
    {
        "id": "5cf5183ed2f95121",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1990,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "a6a9cff3adb40bec",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 1990,
        "y": 1520,
        "wires": [
            []
        ]
    },
    {
        "id": "1d13e113cedd7181",
        "type": "change",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 1480,
        "wires": [
            [
                "99416f28d4419737",
                "181932290653e8e2"
            ]
        ]
    },
    {
        "id": "051234a534ea39e4",
        "type": "subflow:8e72be3f785145d5",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1890,
        "y": 620,
        "wires": [
            [
                "a68b3407abec99cf"
            ]
        ]
    },
    {
        "id": "535d2084d769c5e9",
        "type": "subflow:8e72be3f785145d5",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1110,
        "y": 1400,
        "wires": [
            [
                "e5f759805b849711"
            ]
        ]
    },
    {
        "id": "a35a93dcc648d338",
        "type": "subflow:8e72be3f785145d5",
        "z": "4071dc9a91cae7dd",
        "name": "",
        "x": 1390,
        "y": 1280,
        "wires": [
            [
                "91ff92a6cf90d892"
            ]
        ]
    },
    {
        "id": "39c2556a0286f7c1",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Set Keypad",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "alarm_control_panel.lower_stairs_keypad_alarm_control_panel",
            "alarm_control_panel.upper_stairs_keypad_alarm_control_panel"
        ],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "",
        "service": "",
        "x": 1830,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "b6eaf28fb2039744",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Set Keypad",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "alarm_control_panel.lower_stairs_keypad_alarm_control_panel",
            "alarm_control_panel.upper_stairs_keypad_alarm_control_panel"
        ],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "",
        "service": "",
        "x": 1350,
        "y": 320,
        "wires": [
            [
                "24d3a5f0abd80b53"
            ]
        ]
    },
    {
        "id": "f29a3dc14213af39",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 2030,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "9b94a1d1a137aecc",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 2330,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "72ce14ccddaa2cf1",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 2150,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "cb74e3fd2f0b0491",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1910,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "f4d4327e2ee82b95",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1830,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "a22f5432ea0fd90e",
        "type": "api-call-service",
        "z": "4071dc9a91cae7dd",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1558.36669921875,
        "y": 1398.166748046875,
        "wires": [
            []
        ]
    },
    {
        "id": "86930bf56c7bb4c1",
        "type": "junction",
        "z": "4071dc9a91cae7dd",
        "x": 1240,
        "y": 640,
        "wires": [
            [
                "82c4fb725f45b831",
                "d6ecbccd37980f85",
                "bfb589dfac46d06d",
                "c527cb3d34c08cf9"
            ]
        ]
    },
    {
        "id": "e61876679f09f2be",
        "type": "junction",
        "z": "4071dc9a91cae7dd",
        "x": 780,
        "y": 1440,
        "wires": [
            [
                "601fe3933aa3f440",
                "1d13e113cedd7181"
            ]
        ]
    },
    {
        "id": "b1a93b81b91f0ac1",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm  Bypass Enable",
        "version": "6",
        "entityType": "switch",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm  Bypass Enable"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "b10c789da336b15f",
        "type": "subflow",
        "name": "Wrong Code Notification/Brute Force Alarm",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "61ba794b8c0edfff"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 80,
                "wires": [
                    {
                        "id": "83b28f8f4e718c55",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "61ba794b8c0edfff",
        "type": "api-call-service",
        "z": "b10c789da336b15f",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 250,
        "y": 80,
        "wires": [
            [
                "ab4634777ca3232f",
                "7aaeb8f6f94baf32"
            ]
        ]
    },
    {
        "id": "7aaeb8f6f94baf32",
        "type": "api-call-service",
        "z": "b10c789da336b15f",
        "name": "Keypad Input Low Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0b:80:cc:20\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[4],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 250,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "83b28f8f4e718c55",
        "type": "function",
        "z": "b10c789da336b15f",
        "name": "Wrong Code Counter IS 6",
        "func": "var count = flow.get('wrong_code_count');\nif (count == null){count = 0};\ncount = count + 1;\nflow.set('wrong_code_count',count);\n\nif (count == 6){\n    msg.payload = 'Keypad Brute Force Attack';\n    return [msg];\n} else {\n    return;\n};",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "ab4634777ca3232f",
        "type": "trigger",
        "z": "b10c789da336b15f",
        "name": "",
        "op1": "1",
        "op2": "1",
        "op1type": "str",
        "op2type": "str",
        "duration": "5",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 2,
        "x": 490,
        "y": 80,
        "wires": [
            [
                "83b28f8f4e718c55"
            ],
            [
                "e43dc8d36e24d385"
            ]
        ]
    },
    {
        "id": "e43dc8d36e24d385",
        "type": "change",
        "z": "b10c789da336b15f",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "wrong_code_count",
                "pt": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "d2d431d61fb8d768",
        "type": "tab",
        "label": "ALARM: System Engine",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "86a7f469414bc8e3",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "Keymaster Desired PIN State Changed",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [],
            "substring": [
                "binary_sensor.frontdoor_keymaster_code_slot_"
            ],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "string",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            },
            {
                "property": "delay",
                "propertyType": "msg",
                "value": "keymaster",
                "valueType": "str"
            }
        ],
        "x": 190,
        "y": 100,
        "wires": [
            [
                "6a9baae864de9f92"
            ]
        ]
    },
    {
        "id": "34620e88a3199f66",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Compile Active User Codes on Keymaster PIN State Change // Add Local Users from Dashboard",
        "info": "",
        "x": 370,
        "y": 40,
        "wires": []
    },
    {
        "id": "6d453eb87876bbff",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Fire/CO Event Trigger",
        "info": "",
        "x": 160,
        "y": 280,
        "wires": []
    },
    {
        "id": "02fa453547cfd446",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Leak Event Trigger",
        "info": "",
        "x": 170,
        "y": 740,
        "wires": []
    },
    {
        "id": "0935ca2c30fe475a",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Intrusion Event Triggers",
        "info": "",
        "x": 160,
        "y": 500,
        "wires": []
    },
    {
        "id": "69bea3fb6b35339f",
        "type": "server-events",
        "z": "d2d431d61fb8d768",
        "name": "Upper Stairs Keypad Activity",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "exposeAsEntityConfig": "",
        "eventType": "zha_event",
        "eventData": "{\"device_ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\"command\":\"arm\"}",
        "waitForRunning": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "payload.topic",
                "propertyType": "msg",
                "value": "$outputData(\"eventData\").event.args.arm_mode_description",
                "valueType": "jsonata"
            },
            {
                "property": "payload.code",
                "propertyType": "msg",
                "value": "$outputData(\"eventData\").event.args.code",
                "valueType": "jsonata"
            }
        ],
        "x": 180,
        "y": 920,
        "wires": [
            [
                "23dcc84e7d870751"
            ]
        ]
    },
    {
        "id": "b31a5d6f3e1784d8",
        "type": "server-events",
        "z": "d2d431d61fb8d768",
        "name": "Lower Stairs Keypad Activity",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "exposeAsEntityConfig": "",
        "eventType": "zha_event",
        "eventData": "{\"device_ieee\":\"00:0d:6f:00:0b:80:cc:20\",\"command\":\"arm\"}",
        "waitForRunning": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "payload.topic",
                "propertyType": "msg",
                "value": "$outputData(\"eventData\").event.args.arm_mode_description",
                "valueType": "jsonata"
            },
            {
                "property": "payload.code",
                "propertyType": "msg",
                "value": "$outputData(\"eventData\").event.args.code",
                "valueType": "jsonata"
            }
        ],
        "x": 180,
        "y": 980,
        "wires": [
            [
                "23dcc84e7d870751"
            ]
        ]
    },
    {
        "id": "d42129e7a38ff988",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Process Keypad/Panel Commands",
        "info": "",
        "x": 200,
        "y": 860,
        "wires": []
    },
    {
        "id": "23dcc84e7d870751",
        "type": "function",
        "z": "d2d431d61fb8d768",
        "name": "Validate Pin Code",
        "func": "function ValidateCode(code) {\n    \n    let pin = flow.get('pin') || [];\n    let index = pin.findIndex(obj => { return obj.number === code });\n    \n    if(index >= 0) {\n        return {\n            passTest : true,\n            pin_name : pin[index].name\n        };\n    } else {\n        return {\n            passTest : false\n        };\n    };\n};\n\nif(msg.payload.code != null){\n    let validated = ValidateCode(msg.payload.code);\n\n    if(validated.passTest == true){\n        msg.pin_name = validated.pin_name;\n\n        switch (msg.payload.topic){\n            case 'Disarm':{\n                msg.payload = 'disarm';\n                break;\n            }\n            case 'Arm_Day_Home_Only': {\n                msg.payload = 'arm_home';\n                break;\n            }      \n            case 'Arm_All_Zones': {\n                msg.payload = 'arm_away';\n                break;\n            }\n            case 'Arm_Night_Sleep_Only': {\n                msg.payload = 'arm_night';\n                break;\n            }\n        };\n\n        return [msg,null,null];\n    } else {\n\n        if(msg.payload.code == '2580'){\n            msg.payload = 'disarm';\n            msg.pin_name = 'duress';\n            return [null,null,msg];\n        };\n        \n        msg.payload = 'invalid code';\n        msg.pin_name = 'invalid code';\n        return [null,msg,null];\n    };\n};",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 980,
        "wires": [
            [
                "74ec7c2fb7fcd6e4"
            ],
            [
                "a4fecbc2b499bd04"
            ],
            [
                "2cf86d27ed7b6d75",
                "e8419982bb31d291"
            ]
        ]
    },
    {
        "id": "cb8c881b876b5e92",
        "type": "inject",
        "z": "d2d431d61fb8d768",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 720,
        "y": 4020,
        "wires": [
            [
                "63400179c539fd06"
            ]
        ]
    },
    {
        "id": "63400179c539fd06",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Keypad Input High Beep",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":0,\t   \"args\":[1],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 950,
        "y": 3960,
        "wires": [
            []
        ]
    },
    {
        "id": "e195f6bd53aa2573",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Keypad  Arming  Flash",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":4,\t   \"args\":[8,0,0,0],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 940,
        "y": 4020,
        "wires": [
            []
        ]
    },
    {
        "id": "3a22931b9a2d529b",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Keypad  Arming Away Flash",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":4,\t   \"args\":[10,0,0,0],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 960,
        "y": 4080,
        "wires": [
            []
        ]
    },
    {
        "id": "a4fecbc2b499bd04",
        "type": "subflow:b10c789da336b15f",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 950,
        "y": 980,
        "wires": [
            [
                "5b7a6a98f479b5df"
            ]
        ]
    },
    {
        "id": "88daa136bb98b847",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Master Switch",
        "info": "",
        "x": 150,
        "y": 1180,
        "wires": []
    },
    {
        "id": "ae2cfe6fe8e81782",
        "type": "function",
        "z": "d2d431d61fb8d768",
        "name": "Validate Pin Code",
        "func": "function ValidateCode(code) {\n    // Looks up the pin in the flow variable 'pin' (e.g., [{'number': '1234', 'name': 'User A'}, ...])\n    let pin = flow.get('pin') || [];\n    let index = pin.findIndex(obj => { return obj.number === code });\n\n    if (index >= 0) {\n        return {\n            passTest: true,\n            pin_name: pin[index].name\n        };\n    } else {\n        return {\n            passTest: false\n        };\n    };\n};\n\n// Check for the custom 'code' field sent by your command_template\nif(msg.payload.code != null){\n    let validated = ValidateCode(msg.payload.code);\n\n    if(validated.passTest == true){\n        msg.pin_name = validated.pin_name;\n        \n        // --- CORRECTED TRANSLATION LOGIC ---\n        // The Custom Command comes in via msg.payload.topic (e.g., 'Arm_Day_Home_Only')\n        const commandTopic = msg.payload.topic;\n        let newState;\n        \n        switch (commandTopic) {\n            case 'Disarm':\n                newState = 'disarmed';\n                break;\n            case 'Arm_Day_Home_Only':\n                newState = 'armed_home';\n                break;\n            case 'Arm_All_Zones':\n                newState = 'armed_away';\n                break;\n            case 'Arm_Night_Sleep_Only':\n                newState = 'armed_night'; // Assuming this maps to 'armed_night' or 'armed_home'\n                break;\n            default:\n                node.warn(\"Unknown custom command received: \" + commandTopic);\n                return [msg,null];\n        }\n\n        // Set the final state string expected by your subflow (732236be6337edb5)\n        msg.payload = newState; \n        \n        return [null, msg]; // SUCCESS: Output to Wire 2\n    } else {\n        // PIN FAILURE: Output to Wire 1\n        node.warn(\"Invalid PIN attempted for command: \" + msg.payload.topic);\n        return [msg, null]; \n    };\n};\n\nreturn null; // Stop if no code field is present in the payload",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1260,
        "wires": [
            [
                "03ec135b42b986d9"
            ],
            [
                "ecccc2bf997e198c",
                "39c8d30d6f7673d0"
            ]
        ]
    },
    {
        "id": "03ec135b42b986d9",
        "type": "subflow:b10c789da336b15f",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 710,
        "y": 1260,
        "wires": [
            [
                "1e1be53045fee736"
            ]
        ]
    },
    {
        "id": "ecccc2bf997e198c",
        "type": "switch",
        "z": "d2d431d61fb8d768",
        "name": "Check msg.topic",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "disarmed",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 620,
        "y": 1380,
        "wires": [
            [
                "319b4856ecb2ca02",
                "d83d315628e22046"
            ]
        ]
    },
    {
        "id": "0efa55941bf3a66c",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Fire Switch/Status",
        "info": "",
        "x": 170,
        "y": 1500,
        "wires": []
    },
    {
        "id": "a2278472fe0ccd80",
        "type": "api-current-state",
        "z": "d2d431d61fb8d768",
        "name": "Check alarm_master_status ARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "armed_home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.alarm_master_status",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 430,
        "y": 1560,
        "wires": [
            [
                "742d8aedbc8b1984"
            ],
            []
        ]
    },
    {
        "id": "f3876464c847a04e",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Keypad Entry Delay",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "zha.issue_zigbee_cluster_command",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\t   \"ieee\":\"00:0d:6f:00:0c:fc:c8:69\",\t   \"cluster_id\":1281,\t   \"command\":4,\t   \"args\":[5,15,1,0],\t   \"command_type\":\"client\",\t   \"endpoint_id\":1,\t   \"cluster_type\":\"out\"\t}",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "zha",
        "service": "issue_zigbee_cluster_command",
        "x": 940,
        "y": 3900,
        "wires": [
            []
        ]
    },
    {
        "id": "f7bc066bad2715ce",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Change Security Alarm State on Mode Change",
        "info": "",
        "x": 240,
        "y": 1760,
        "wires": []
    },
    {
        "id": "291c495fc70828d4",
        "type": "api-current-state",
        "z": "d2d431d61fb8d768",
        "name": "Check armed_state NOT DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "disarmed",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "entity_id": "sensor.alarm_armed_state",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 490,
        "y": 1820,
        "wires": [
            [
                "d005312b47203eca"
            ],
            []
        ]
    },
    {
        "id": "e3b930cec54454d7",
        "type": "api-current-state",
        "z": "d2d431d61fb8d768",
        "name": "Check armed_state DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "disarmed",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "sensor.alarm_armed_state",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 470,
        "y": 1900,
        "wires": [
            [
                "53c1a9a83892ce94"
            ],
            []
        ]
    },
    {
        "id": "937ebe3fc828f70e",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Notify Armed if Garage Entry Door Opened",
        "info": "",
        "x": 220,
        "y": 2100,
        "wires": []
    },
    {
        "id": "d2651e603d8c0a90",
        "type": "trigger-state",
        "z": "d2d431d61fb8d768",
        "name": "Garage Entry Door OPEN",
        "server": "cc16ce7d.d93d8",
        "version": 5,
        "inputs": 0,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "binary_sensor.garage_entry_sensor_opening_2"
            ],
            "substring": [],
            "regex": []
        },
        "debugEnabled": false,
        "constraints": [
            {
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "on"
            },
            {
                "targetType": "entity_id",
                "targetValue": "sensor.alarm_armed_state",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is_not",
                "comparatorValueDatatype": "str",
                "comparatorValue": "disarmed"
            }
        ],
        "customOutputs": [],
        "outputInitially": false,
        "stateType": "str",
        "enableInput": false,
        "x": 170,
        "y": 2180,
        "wires": [
            [
                "1c5a0bccfa221d7f"
            ],
            []
        ]
    },
    {
        "id": "762217c572d42dd2",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "Secondary Mode HOME",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "input_select.mode_secondary"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "Home",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 170,
        "y": 1860,
        "wires": [
            [
                "291c495fc70828d4"
            ],
            [
                "e3b930cec54454d7"
            ]
        ]
    },
    {
        "id": "612a3b6241437791",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Arm/Disarm Based upon Schlage Lock Keypad",
        "info": "",
        "x": 240,
        "y": 2260,
        "wires": []
    },
    {
        "id": "dd21b60d2c649626",
        "type": "api-current-state",
        "z": "d2d431d61fb8d768",
        "name": "Check NOT DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "disarmed",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "entity_id": "sensor.alarm_armed_state",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 650,
        "y": 2400,
        "wires": [
            [
                "cbc7a7cf306188a1"
            ],
            []
        ]
    },
    {
        "id": "0fe46c20666531d6",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "Front Door alarmType CHANGED",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "sensor.front_door_lock_alarmtype"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 190,
        "y": 2360,
        "wires": [
            [
                "dd0cb7e9d499c0c3"
            ]
        ]
    },
    {
        "id": "dd0cb7e9d499c0c3",
        "type": "switch",
        "z": "d2d431d61fb8d768",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "18",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "19",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 2360,
        "wires": [
            [
                "a9314bd6d4a1da4a"
            ],
            [
                "dd21b60d2c649626"
            ]
        ]
    },
    {
        "id": "a9314bd6d4a1da4a",
        "type": "api-current-state",
        "z": "d2d431d61fb8d768",
        "name": "mode_secondary AWAY",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "halt_if": "Away",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "entity_id": "input_select.mode_secondary",
        "state_type": "str",
        "blockInputOverrides": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            }
        ],
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "override_topic": false,
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "x": 650,
        "y": 2320,
        "wires": [
            [
                "4e4c80ab6478ea97"
            ],
            []
        ]
    },
    {
        "id": "74ec7c2fb7fcd6e4",
        "type": "subflow:4071dc9a91cae7dd",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 920,
        "y": 920,
        "wires": []
    },
    {
        "id": "2cf86d27ed7b6d75",
        "type": "subflow:4071dc9a91cae7dd",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 920,
        "y": 1040,
        "wires": []
    },
    {
        "id": "e8419982bb31d291",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "sensor_type",
                "pt": "msg",
                "to": "PANIC",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "trigger",
                "pt": "msg",
                "to": "{\"sensor\" : \"panic code\"}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "trigger.time",
                "pt": "msg",
                "to": "homeassistant.homeAssistant.states['sensor.date_time'].state",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 1100,
        "wires": [
            [
                "88ce1c840ae509cc"
            ]
        ]
    },
    {
        "id": "39c8d30d6f7673d0",
        "type": "ha-sensor",
        "z": "d2d431d61fb8d768",
        "name": "Set alarm_master_status",
        "entityConfig": "e8210404c702f102",
        "version": 0,
        "state": "payload",
        "stateType": "msg",
        "attributes": [
            {
                "property": "changed_by",
                "value": "pin_name",
                "valueType": "msg"
            }
        ],
        "inputOverride": "allow",
        "outputProperties": [],
        "x": 650,
        "y": 1320,
        "wires": [
            []
        ]
    },
    {
        "id": "93bdc9ac2991ca54",
        "type": "subflow:4071dc9a91cae7dd",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1060,
        "y": 1860,
        "wires": []
    },
    {
        "id": "d005312b47203eca",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "disarm",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "pin_name",
                "pt": "msg",
                "to": "supervisor",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 1820,
        "wires": [
            [
                "93bdc9ac2991ca54"
            ]
        ]
    },
    {
        "id": "53c1a9a83892ce94",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "arm_away",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "pin_name",
                "pt": "msg",
                "to": "supervisor",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 1900,
        "wires": [
            [
                "93bdc9ac2991ca54"
            ]
        ]
    },
    {
        "id": "7da8effa52a7a43a",
        "type": "subflow:4071dc9a91cae7dd",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 700,
        "y": 2020,
        "wires": []
    },
    {
        "id": "51bac84df8ab659a",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "arm_night",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "pin_name",
                "pt": "msg",
                "to": "supervisor",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 2020,
        "wires": [
            [
                "7da8effa52a7a43a"
            ]
        ]
    },
    {
        "id": "41aae586927ac4b3",
        "type": "subflow:4071dc9a91cae7dd",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1180,
        "y": 2360,
        "wires": []
    },
    {
        "id": "4e4c80ab6478ea97",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "arm_away",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "pin_name",
                "pt": "msg",
                "to": "supervisor",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 2320,
        "wires": [
            [
                "41aae586927ac4b3"
            ]
        ]
    },
    {
        "id": "cbc7a7cf306188a1",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "disarm",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "pin_name",
                "pt": "msg",
                "to": "supervisor",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 2400,
        "wires": [
            [
                "41aae586927ac4b3"
            ]
        ]
    },
    {
        "id": "4774196b53ba2845",
        "type": "subflow:174c2011475d038d",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 740,
        "y": 380,
        "wires": [
            [
                "92cbca911f6e4a33"
            ]
        ]
    },
    {
        "id": "2c634cf0ef4a3462",
        "type": "subflow:174c2011475d038d",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 820,
        "y": 620,
        "wires": [
            [
                "37a2c6a156da54e6",
                "17c69bc818230fb4"
            ]
        ]
    },
    {
        "id": "2fc1bae348a91c1b",
        "type": "subflow:174c2011475d038d",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 420,
        "y": 780,
        "wires": [
            [
                "b402753f93c368ca"
            ]
        ]
    },
    {
        "id": "b2fd39209600c74a",
        "type": "subflow:4bcf46b11bf99871",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1170,
        "y": 380,
        "wires": []
    },
    {
        "id": "b402753f93c368ca",
        "type": "subflow:4bcf46b11bf99871",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 690,
        "y": 780,
        "wires": []
    },
    {
        "id": "88ce1c840ae509cc",
        "type": "subflow:4bcf46b11bf99871",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1110,
        "y": 1100,
        "wires": []
    },
    {
        "id": "6496b54e3d73756b",
        "type": "subflow:4bcf46b11bf99871",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1510,
        "y": 980,
        "wires": []
    },
    {
        "id": "1e1be53045fee736",
        "type": "subflow:41ebd12435392355",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1040,
        "y": 1260,
        "wires": [
            [
                "a1c485dcb25f5bcf"
            ]
        ]
    },
    {
        "id": "a1c485dcb25f5bcf",
        "type": "subflow:4bcf46b11bf99871",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1310,
        "y": 1260,
        "wires": []
    },
    {
        "id": "37a2c6a156da54e6",
        "type": "subflow:a90b3a670eb5e15a",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1060,
        "y": 580,
        "wires": [
            [
                "e139eebcd59c764d"
            ]
        ]
    },
    {
        "id": "17c69bc818230fb4",
        "type": "subflow:f33a1718373525b4",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1090,
        "y": 640,
        "wires": []
    },
    {
        "id": "e139eebcd59c764d",
        "type": "subflow:4bcf46b11bf99871",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1310,
        "y": 580,
        "wires": []
    },
    {
        "id": "083e901730467ede",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "Delay Intrusion Sensors",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "group.alarm_active_delay_sensor_group"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            },
            {
                "property": "sensor_type",
                "propertyType": "msg",
                "value": "INTRUDER",
                "valueType": "str"
            },
            {
                "property": "delay",
                "propertyType": "msg",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "x": 160,
        "y": 660,
        "wires": [
            [
                "a6af1c8850fbb547"
            ],
            []
        ]
    },
    {
        "id": "4c8590c9a3faaf1a",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "Instant Intrusion Sensors",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "group.alarm_active_instant_sensor_group"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            },
            {
                "property": "sensor_type",
                "propertyType": "msg",
                "value": "INTRUDER",
                "valueType": "str"
            },
            {
                "property": "delay",
                "propertyType": "msg",
                "value": "false",
                "valueType": "bool"
            }
        ],
        "x": 150,
        "y": 580,
        "wires": [
            [
                "a6af1c8850fbb547"
            ],
            []
        ]
    },
    {
        "id": "fc0776e70a08dba2",
        "type": "ha-wait-until",
        "z": "d2d431d61fb8d768",
        "name": "Wait Until alarm_fire_status DISARMED",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "outputs": 2,
        "entities": {
            "entity": [
                "sensor.alarm_fire_status"
            ],
            "substring": [],
            "regex": []
        },
        "property": "",
        "comparator": "is",
        "value": "disarmed",
        "valueType": "str",
        "timeout": "120",
        "timeoutType": "num",
        "timeoutUnits": "seconds",
        "checkCurrentState": true,
        "blockInputOverrides": true,
        "outputProperties": [
            {
                "property": "reset",
                "propertyType": "msg",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "entityLocation": "data",
        "entityLocationType": "none",
        "x": 940,
        "y": 320,
        "wires": [
            [
                "92cbca911f6e4a33"
            ],
            []
        ]
    },
    {
        "id": "92cbca911f6e4a33",
        "type": "trigger",
        "z": "d2d431d61fb8d768",
        "name": "Delay",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "250",
        "extend": false,
        "overrideDelay": true,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 2,
        "x": 950,
        "y": 380,
        "wires": [
            [
                "fc0776e70a08dba2"
            ],
            [
                "b2fd39209600c74a"
            ]
        ]
    },
    {
        "id": "d83d315628e22046",
        "type": "subflow:a5da2b3babd8e8c2",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 860,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "6b948b0a28c5d854",
        "type": "subflow:c403638dc6be311a",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1080,
        "y": 1560,
        "wires": []
    },
    {
        "id": "9dc65d9b944fdd7d",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "Smoke Sensors",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "group.alarm_active_smoke_sensor_group"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            },
            {
                "property": "sensor_type",
                "propertyType": "msg",
                "value": "FIRE",
                "valueType": "str"
            }
        ],
        "x": 120,
        "y": 340,
        "wires": [
            [
                "d9fcd5f34fcdb5b9"
            ],
            []
        ]
    },
    {
        "id": "bb7ee368e0eb8550",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "CO Sensors",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 2,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "group.alarm_active_co_sensor_group"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "on",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": false,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            },
            {
                "property": "sensor_type",
                "propertyType": "msg",
                "value": "CARBON MONOXIDE",
                "valueType": "str"
            }
        ],
        "x": 130,
        "y": 420,
        "wires": [
            [
                "d9fcd5f34fcdb5b9"
            ],
            []
        ]
    },
    {
        "id": "63475b34ec221f0b",
        "type": "subflow:a5da2b3babd8e8c2",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1240,
        "y": 1620,
        "wires": [
            [
                "46a3c7c193d75a7f",
                "8535ac4a8f46c374"
            ]
        ]
    },
    {
        "id": "742d8aedbc8b1984",
        "type": "switch",
        "z": "d2d431d61fb8d768",
        "name": "msg.topic NOT DISARM",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "Disarm",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 750,
        "y": 1560,
        "wires": [
            [
                "6b948b0a28c5d854"
            ],
            [
                "1075759de6960c3b"
            ]
        ]
    },
    {
        "id": "1075759de6960c3b",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "topic",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1000,
        "y": 1620,
        "wires": [
            [
                "63475b34ec221f0b"
            ]
        ]
    },
    {
        "id": "d9fcd5f34fcdb5b9",
        "type": "switch",
        "z": "d2d431d61fb8d768",
        "name": "Check alarm_fire_status NOT DISARMED",
        "property": "homeassistant.homeAssistant.states['sensor.alarm_fire_status'].state",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "disarmed",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 420,
        "y": 380,
        "wires": [
            [
                "4774196b53ba2845"
            ]
        ]
    },
    {
        "id": "a635dc5b5e904ebf",
        "type": "function",
        "z": "d2d431d61fb8d768",
        "name": "Compose Message",
        "func": "msg.payload = 'The fire alarm system is disarmed.';\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1750,
        "y": 1620,
        "wires": [
            [
                "bc020853282639ef"
            ]
        ]
    },
    {
        "id": "9f38ee8eba72caf9",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Reload Trigger Sensor Groups on HA start/Node Red start",
        "info": "",
        "x": 270,
        "y": 2500,
        "wires": []
    },
    {
        "id": "028d469ea3fdfed8",
        "type": "server-events",
        "z": "d2d431d61fb8d768",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 3,
        "exposeAsEntityConfig": "",
        "eventType": "home_assistant_client",
        "eventData": "",
        "waitForRunning": true,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "$outputData(\"eventData\").event_type",
                "valueType": "jsonata"
            }
        ],
        "x": 180,
        "y": 2580,
        "wires": [
            [
                "10cc6dfc827aa017"
            ]
        ]
    },
    {
        "id": "10cc6dfc827aa017",
        "type": "switch",
        "z": "d2d431d61fb8d768",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "running",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 410,
        "y": 2580,
        "wires": [
            [
                "541e6ebb61f5f9a8"
            ]
        ]
    },
    {
        "id": "541e6ebb61f5f9a8",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "Get Trigger Sensors",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "sensor_groups",
                "tot": "flow",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 2580,
        "wires": [
            [
                "71a424be2b0fb95b"
            ]
        ]
    },
    {
        "id": "71a424be2b0fb95b",
        "type": "split",
        "z": "d2d431d61fb8d768",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 830,
        "y": 2580,
        "wires": [
            [
                "9f7621abdd6dbfb6"
            ]
        ]
    },
    {
        "id": "9f7621abdd6dbfb6",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.data",
                "pt": "msg",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 2580,
        "wires": [
            [
                "3f24a527fdb58fb1"
            ]
        ]
    },
    {
        "id": "3f24a527fdb58fb1",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "group.set",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "group",
        "service": "set",
        "x": 1260,
        "y": 2580,
        "wires": [
            []
        ]
    },
    {
        "id": "27dd3139eac591f6",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Miscellaneous Setup Entities",
        "info": "",
        "x": 180,
        "y": 2680,
        "wires": []
    },
    {
        "id": "e93f84b961a72cc5",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Smoke Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "7c14120a8388d81e",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 190,
        "y": 2740,
        "wires": [
            []
        ]
    },
    {
        "id": "021217fb52fae5b8",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm CO Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "1c6f3be39e7ca801",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 200,
        "y": 2800,
        "wires": [
            []
        ]
    },
    {
        "id": "5adccfec884ae8b4",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Home Entry Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "7b5ce1638adcbcdf",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 170,
        "y": 2860,
        "wires": [
            []
        ]
    },
    {
        "id": "fc16d7e0e4e43fce",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Home Exit Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "285334f7b18c773e",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 180,
        "y": 2920,
        "wires": [
            []
        ]
    },
    {
        "id": "50ba18a6dda118d6",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Night Entry Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "918c67579b1ada52",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 180,
        "y": 2980,
        "wires": [
            []
        ]
    },
    {
        "id": "5aa82fa0b4bf9714",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Night Exit Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "0db6bea9a4c8bf70",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 180,
        "y": 3040,
        "wires": [
            []
        ]
    },
    {
        "id": "62ef7e619979b28b",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Away Entry Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "ee64fe6e3e8fc577",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 180,
        "y": 3100,
        "wires": [
            []
        ]
    },
    {
        "id": "2d7519a07be7af27",
        "type": "ha-number",
        "z": "d2d431d61fb8d768",
        "name": "Alarm Away Exit Delay",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "c735614284da7411",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            }
        ],
        "x": 180,
        "y": 3160,
        "wires": [
            []
        ]
    },
    {
        "id": "5ea7780e8b869e1b",
        "type": "comment",
        "z": "d2d431d61fb8d768",
        "name": "Blue Iris Coordination / Send Snapshot Alerts",
        "info": "",
        "x": 230,
        "y": 3260,
        "wires": []
    },
    {
        "id": "b6a12c1754c6f7a1",
        "type": "server-state-changed",
        "z": "d2d431d61fb8d768",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 6,
        "outputs": 1,
        "exposeAsEntityConfig": "",
        "entities": {
            "entity": [
                "sensor.alarm_type_state"
            ],
            "substring": [],
            "regex": []
        },
        "outputInitially": false,
        "stateType": "str",
        "ifState": "",
        "ifStateType": "str",
        "ifStateOperator": "is",
        "outputOnlyOnStateChange": true,
        "for": "0",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "eventData"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            }
        ],
        "x": 240,
        "y": 3360,
        "wires": [
            [
                "0dda934c8e18f109"
            ]
        ]
    },
    {
        "id": "5b7a6a98f479b5df",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "sensor_type",
                "pt": "msg",
                "to": "INTRUDER",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "trigger",
                "pt": "msg",
                "to": "{\"sensor\" : \"keypads\"}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "trigger.time",
                "pt": "msg",
                "to": "homeassistant.homeAssistant.states['sensor.date_time'].state",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1260,
        "y": 980,
        "wires": [
            [
                "6496b54e3d73756b"
            ]
        ]
    },
    {
        "id": "0dda934c8e18f109",
        "type": "switch",
        "z": "d2d431d61fb8d768",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "INTRUDER",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "clear",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 3360,
        "wires": [
            [
                "de43c20ecacee6ac"
            ],
            [
                "dc0822ddec070f26"
            ]
        ]
    },
    {
        "id": "84b89e4f3bbb5c13",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Set BlueIris Profile ALARM",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "switch.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "switch.security_profile_alarm"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "switch",
        "service": "turn_on",
        "x": 1800,
        "y": 3320,
        "wires": [
            []
        ]
    },
    {
        "id": "de43c20ecacee6ac",
        "type": "ha-get-entities",
        "z": "d2d431d61fb8d768",
        "name": "",
        "server": "cc16ce7d.d93d8",
        "version": 1,
        "rules": [
            {
                "property": "entity_id",
                "logic": "starts_with",
                "value": "switch.security_profile_",
                "valueType": "str"
            }
        ],
        "outputType": "split",
        "outputEmptyResults": false,
        "outputLocationType": "msg",
        "outputLocation": "payload",
        "outputResultsCount": 1,
        "x": 690,
        "y": 3320,
        "wires": [
            [
                "c45495b3ee2fa652"
            ]
        ]
    },
    {
        "id": "c45495b3ee2fa652",
        "type": "join",
        "z": "d2d431d61fb8d768",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 870,
        "y": 3320,
        "wires": [
            [
                "cd27f6e15aa7c6e7"
            ]
        ]
    },
    {
        "id": "cd27f6e15aa7c6e7",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.data.scene_id",
                "pt": "msg",
                "to": "alarm_bi_save_state",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.data.snapshot_entities",
                "pt": "msg",
                "to": "payload.entity_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 3320,
        "wires": [
            [
                "c7c69e4402fb2a96"
            ]
        ]
    },
    {
        "id": "c7c69e4402fb2a96",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Create Save Scene",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "scene.create",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "scene",
        "service": "create",
        "x": 1290,
        "y": 3320,
        "wires": [
            [
                "87b0aced75cb85d2"
            ]
        ]
    },
    {
        "id": "87b0aced75cb85d2",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1530,
        "y": 3320,
        "wires": [
            [
                "84b89e4f3bbb5c13"
            ]
        ]
    },
    {
        "id": "dc0822ddec070f26",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Restore BI Profiles",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "scene.turn_on",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [
            "scene.alarm_bi_save_state"
        ],
        "labelId": [],
        "data": "",
        "dataType": "jsonata",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "scene",
        "service": "turn_on",
        "x": 710,
        "y": 3400,
        "wires": [
            []
        ]
    },
    {
        "id": "d0be1ecacefb8c5d",
        "type": "mqtt in",
        "z": "d2d431d61fb8d768",
        "name": "Listen for BI MQTT Alert",
        "topic": "BI/+/alert-image-b64",
        "qos": "2",
        "datatype": "utf8",
        "broker": "35c3b8b4dd3e8a28",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 180,
        "y": 3480,
        "wires": [
            [
                "6b671d1fd87d5a13"
            ]
        ]
    },
    {
        "id": "ac9957319666ba07",
        "type": "jimp-image",
        "z": "d2d431d61fb8d768",
        "name": "Save Image",
        "data": "payload",
        "dataType": "msg",
        "ret": "img",
        "parameter1": "topic.filename_save",
        "parameter1Type": "msg",
        "parameter2": "",
        "parameter2Type": "num",
        "parameter3": "0",
        "parameter3Type": "num",
        "parameter4": "RESIZE_NEAREST_NEIGHBOR",
        "parameter4Type": "none",
        "parameter5": "",
        "parameter5Type": "none",
        "parameter6": "",
        "parameter6Type": "none",
        "parameter7": "",
        "parameter7Type": "none",
        "parameter8": "",
        "parameter8Type": "",
        "sendProperty": "payload",
        "parameterCount": 1,
        "jimpFunction": "write",
        "selectedJimpFunction": {
            "name": "write",
            "fn": "write",
            "description": "Write to file. NOTE: You can specify an alternative file extension type to change the type. Currently support types are jpg, png, bmp.",
            "parameters": [
                {
                    "name": "filename",
                    "type": "str",
                    "required": true,
                    "hint": "Name of the file",
                    "defaultType": "str"
                }
            ]
        },
        "x": 570,
        "y": 3480,
        "wires": [
            [
                "bfda53acae88efd9"
            ]
        ],
        "icon": "font-awesome/fa-image"
    },
    {
        "id": "6b671d1fd87d5a13",
        "type": "function",
        "z": "d2d431d61fb8d768",
        "name": "Split",
        "func": "let topic = msg.topic.split('/', 3);\nmsg.topic = {\n    \"filename_save\" : '/homeassistant/www/media/BI_alert_' + topic[1] + '.jpg',\n    \"filename_recall\": 'https://o1ci27y8l6euxxf9wfb2z46mbn05t0rm.ui.nabu.casa/local/media/BI_alert_' + topic[1] + '.jpg',\n    \"camera\" : topic[1]\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 3480,
        "wires": [
            [
                "ac9957319666ba07"
            ]
        ]
    },
    {
        "id": "319b4856ecb2ca02",
        "type": "subflow:732236be6337edb5",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 860,
        "y": 1380,
        "wires": [
            [
                "06187ccd3f3bd164"
            ]
        ]
    },
    {
        "id": "680dc0ab36eaa2bd",
        "type": "subflow:41ebd12435392355",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1340,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "06187ccd3f3bd164",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "clear",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1100,
        "y": 1380,
        "wires": [
            [
                "680dc0ab36eaa2bd"
            ]
        ]
    },
    {
        "id": "553b9178f891339e",
        "type": "ha-text",
        "z": "d2d431d61fb8d768",
        "name": "Local Users",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "50199663477f393a",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            },
            {
                "property": "trigger",
                "propertyType": "msg",
                "value": "local",
                "valueType": "str"
            }
        ],
        "x": 270,
        "y": 160,
        "wires": [
            [
                "6a9baae864de9f92"
            ]
        ]
    },
    {
        "id": "ec56330c26ab5997",
        "type": "function",
        "z": "d2d431d61fb8d768",
        "name": "Process Users / Save PIN File",
        "func": "function ProcessLocalUsers(inputType) {\n\n    let localUsers;\n    let users = [];\n\n    if(inputType == 'local'){\n        localUsers = msg.payload;\n    } else {\n        localUsers = global.get(\"homeassistant.homeAssistant.states['text.alarm_local_users'].state\");\n    };\n\n    if(localUsers != \"\"){\n        let localUsersSplit = localUsers.split(\"/\");\n\n        for (let index = 0; index <localUsersSplit.length; index++) {\n            users[index] = {\n                name : localUsersSplit[index].substring(0, localUsersSplit[index].indexOf(\",\")),\n                number : localUsersSplit[index].substring(localUsersSplit[index].indexOf(\",\") + 1)\n            };\n        };\n\n        return users;\n    };\n\n    return;\n};\n\nfunction ProcessKeymasterUsers(count,lockName) {\n\n    if(count != undefined){\n        let users = [];\n        let desired_state;\n        let name;\n        let number;\n        for (let index = 1; index < count; index++) {\n            desired_state = global.get(\"homeassistant.homeAssistant.states['binary_sensor.\" + lockName + \"_code_slot_\" + index + \"_active'].state\");\n            if (desired_state == \"on\") {\n                number = global.get(\"homeassistant.homeAssistant.states['text.\" + lockName + \"_code_slot_\" + index + \"_pin'].state\");\n                name = global.get(\"homeassistant.homeAssistant.states['text.\" + lockName + \"_code_slot_\" + index + \"_name'].state\");\n                users.push({ \"name\": name, \"number\": number });\n            };\n        };\n\n        return users;\n    };\n\n    return;\n};\n\nlet pin = [];\nlet pin1 = ProcessLocalUsers(msg.trigger);\nlet pin2 = ProcessKeymasterUsers(msg.payload2.length + 1,global.get(\"homeassistant.homeAssistant.states['text.alarm_keymaster_door_name'].state\"));\n\nif (pin1 != null){\n    if (pin2 != null) {\n        pin = pin1.concat(pin2);\n    } else {\n        pin = pin1;\n    };\n} else {\n    pin = pin2;\n};\n\nflow.set (\"pin\",pin);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "8dda4b53d8717b23",
        "type": "ha-text",
        "z": "d2d431d61fb8d768",
        "name": "Keymaster Door Name",
        "version": 1,
        "debugenabled": false,
        "inputs": 0,
        "outputs": 1,
        "entityConfig": "bca80de0dba5a445",
        "mode": "listen",
        "value": "payload",
        "valueType": "msg",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "value"
            },
            {
                "property": "previousValue",
                "propertyType": "msg",
                "value": "",
                "valueType": "previousValue"
            },
            {
                "property": "delay",
                "propertyType": "msg",
                "value": "keymaster",
                "valueType": "str"
            }
        ],
        "x": 440,
        "y": 2740,
        "wires": [
            []
        ]
    },
    {
        "id": "e7030c45a74bdab4",
        "type": "ha-button",
        "z": "d2d431d61fb8d768",
        "name": "Manual Trigger",
        "version": 0,
        "debugenabled": false,
        "outputs": 1,
        "entityConfig": "62e8e338d0addd98",
        "outputProperties": [
            {
                "property": "payload",
                "propertyType": "msg",
                "value": "",
                "valueType": "entityState"
            },
            {
                "property": "topic",
                "propertyType": "msg",
                "value": "",
                "valueType": "triggerId"
            },
            {
                "property": "data",
                "propertyType": "msg",
                "value": "",
                "valueType": "entity"
            },
            {
                "property": "trigger",
                "propertyType": "msg",
                "value": "global",
                "valueType": "str"
            }
        ],
        "x": 260,
        "y": 220,
        "wires": [
            [
                "6a9baae864de9f92"
            ]
        ]
    },
    {
        "id": "826b6a6de1eedc55",
        "type": "trigger-state",
        "z": "d2d431d61fb8d768",
        "name": "mode_primary is NIGHT",
        "server": "cc16ce7d.d93d8",
        "version": 5,
        "inputs": 0,
        "outputs": 2,
        "exposeAsEntityConfig": "b1a93b81b91f0ac1",
        "entities": {
            "entity": [
                "input_select.mode_primary"
            ],
            "substring": [],
            "regex": []
        },
        "debugEnabled": false,
        "constraints": [
            {
                "targetType": "this_entity",
                "targetValue": "",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "Night"
            },
            {
                "targetType": "entity_id",
                "targetValue": "input_select.mode_secondary",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is",
                "comparatorValueDatatype": "str",
                "comparatorValue": "Home"
            },
            {
                "targetType": "entity_id",
                "targetValue": "sensor.alarm_armed_state",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is_not",
                "comparatorValueDatatype": "str",
                "comparatorValue": "armed_away"
            },
            {
                "targetType": "entity_id",
                "targetValue": "sensor.alarm_armed_state",
                "propertyType": "current_state",
                "propertyValue": "new_state.state",
                "comparatorType": "is_not",
                "comparatorValueDatatype": "str",
                "comparatorValue": "armed_night"
            }
        ],
        "customOutputs": [],
        "outputInitially": false,
        "stateType": "str",
        "enableInput": false,
        "x": 170,
        "y": 2020,
        "wires": [
            [
                "51bac84df8ab659a"
            ],
            []
        ]
    },
    {
        "id": "a6af1c8850fbb547",
        "type": "switch",
        "z": "d2d431d61fb8d768",
        "name": "Check alarm_armed_state NOT DISARMED",
        "property": "homeassistant.homeAssistant.states['sensor.alarm_armed_state'].state",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "disarmed",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 490,
        "y": 620,
        "wires": [
            [
                "2c634cf0ef4a3462"
            ]
        ]
    },
    {
        "id": "bfda53acae88efd9",
        "type": "function",
        "z": "d2d431d61fb8d768",
        "name": "Compose Message",
        "func": "let message = 'Camera alert: ' + msg.topic.camera\nmsg.notify = {};\nmsg.notify = {\n    data : {\n        title : 'ALARM NOTIFICATION',\n        message : message,\n        data : {\n            image : msg.topic.filename_recall\n        }\n    }\n};\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 3480,
        "wires": [
            [
                "ae1f0890efe6acba"
            ]
        ]
    },
    {
        "id": "ae1f0890efe6acba",
        "type": "subflow:8e72be3f785145d5",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1010,
        "y": 3480,
        "wires": [
            []
        ]
    },
    {
        "id": "1c5a0bccfa221d7f",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.garage_mini\",\"message\":\"Please disarm the security system before opening the garage door.\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 430,
        "y": 2180,
        "wires": [
            []
        ]
    },
    {
        "id": "bc020853282639ef",
        "type": "api-call-service",
        "z": "d2d431d61fb8d768",
        "name": "Announce on Minis",
        "server": "cc16ce7d.d93d8",
        "version": 7,
        "debugenabled": false,
        "action": "tts.cloud_say",
        "floorId": [],
        "areaId": [],
        "deviceId": [],
        "entityId": [],
        "labelId": [],
        "data": "{\"entity_id\":\"media_player.security_status\",\"message\":\"{{payload}}\",\"options\":{\"voice\":\"CoraNeural\"}}",
        "dataType": "json",
        "mergeContext": "",
        "mustacheAltTags": false,
        "outputProperties": [],
        "queue": "none",
        "blockInputOverrides": false,
        "domain": "tts",
        "service": "cloud_say",
        "x": 1990,
        "y": 1620,
        "wires": [
            []
        ]
    },
    {
        "id": "6a9baae864de9f92",
        "type": "ha-get-entities",
        "z": "d2d431d61fb8d768",
        "name": "Get Pin_State entities",
        "server": "cc16ce7d.d93d8",
        "version": 1,
        "rules": [
            {
                "condition": "state_object",
                "property": "entity_id",
                "logic": "starts_with",
                "value": "'text.' & $globalContext(\"homeassistant.homeAssistant.states['text.alarm_keymaster_door_name'].state\" ) & '_code_slot_'",
                "valueType": "jsonata"
            }
        ],
        "outputType": "array",
        "outputEmptyResults": true,
        "outputLocationType": "msg",
        "outputLocation": "payload2",
        "outputResultsCount": 1,
        "x": 500,
        "y": 160,
        "wires": [
            [
                "ec56330c26ab5997"
            ]
        ]
    },
    {
        "id": "eef7f105f72efbac",
        "type": "mqtt in",
        "z": "d2d431d61fb8d768",
        "name": "MQTT Security Panel",
        "topic": "alarm/security/command",
        "qos": "2",
        "datatype": "json",
        "broker": "35c3b8b4dd3e8a28",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 200,
        "y": 1040,
        "wires": [
            [
                "b143d98561a1bed5"
            ]
        ]
    },
    {
        "id": "71cf7c7f233a4636",
        "type": "mqtt in",
        "z": "d2d431d61fb8d768",
        "name": "MQTT Fire Panel",
        "topic": "alarm/fire/command",
        "qos": "2",
        "datatype": "json",
        "broker": "35c3b8b4dd3e8a28",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 1560,
        "wires": [
            [
                "a2278472fe0ccd80"
            ]
        ]
    },
    {
        "id": "46a3c7c193d75a7f",
        "type": "subflow:732236be6337edb5",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1500,
        "y": 1620,
        "wires": [
            [
                "a635dc5b5e904ebf"
            ]
        ]
    },
    {
        "id": "8535ac4a8f46c374",
        "type": "change",
        "z": "d2d431d61fb8d768",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "clear",
                "tot": "str",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1480,
        "y": 1680,
        "wires": [
            [
                "f30aa2f4b51bf247"
            ]
        ]
    },
    {
        "id": "f30aa2f4b51bf247",
        "type": "subflow:41ebd12435392355",
        "z": "d2d431d61fb8d768",
        "name": "",
        "x": 1720,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "c8deb92be204f751",
        "type": "mqtt in",
        "z": "d2d431d61fb8d768",
        "name": "MQTT Master Panel",
        "topic": "alarm/master/command",
        "qos": "2",
        "datatype": "json",
        "broker": "35c3b8b4dd3e8a28",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 1260,
        "wires": [
            [
                "ae2cfe6fe8e81782"
            ]
        ]
    },
    {
        "id": "b143d98561a1bed5",
        "type": "function",
        "z": "d2d431d61fb8d768",
        "name": "Translate",
        "func": "// Function: Translate MQTT Action\n// This function converts the standard HA action (e.g., 'DISARM') \n// into your legacy custom command string (e.g., 'Disarm').\n\nif (msg.payload && msg.payload.action) {\n    \n    // 1. Get the standard action name sent by Home Assistant (e.g., \"DISARM\")\n    const standardAction = msg.payload.action;\n    \n    // 2. Define the exact case-sensitive output string\n    let customTopic;\n\n    switch (standardAction) {\n        case 'disarm':\n            customTopic = 'Disarm'; // Note the capital 'D'\n            break;\n        case 'arm_home':\n            customTopic = 'Arm_Day_Home_Only';\n            break;\n        case 'arm_away':\n            customTopic = 'Arm_All_Zones';\n            break;\n        case 'arm_night':\n            customTopic = 'Arm_Night_Sleep_Only';\n            break;\n        default:\n            node.warn(\"Unsupported standard action received: \" + standardAction);\n            return null; // Stop the flow for unsupported commands\n    }\n    \n    // 3. Set the fields required by the downstream Validate Pin Code function:\n    \n    // Set msg.topic to the exact custom string (e.g., 'Disarm')\n    msg.payload.topic = customTopic;\n    \n    // Set msg.code for validation\n    msg.payload.code = msg.payload.code;\n    \n    // Return the message with the corrected fields\n    return msg;\n}\n\n// Block messages that don't conform to the expected MQTT payload\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 1040,
        "wires": [
            [
                "23dcc84e7d870751",
                "af5124964a88c9d5"
            ]
        ]
    },
    {
        "id": "5d5964e72089a82a",
        "type": "inject",
        "z": "d2d431d61fb8d768",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "disarm",
        "payloadType": "str",
        "x": 670,
        "y": 860,
        "wires": [
            [
                "74ec7c2fb7fcd6e4"
            ]
        ]
    },
    {
        "id": "af5124964a88c9d5",
        "type": "debug",
        "z": "d2d431d61fb8d768",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 860,
        "wires": []
    },
    {
        "id": "cc16ce7d.d93d8",
        "type": "server",
        "name": "Home Assistant",
        "addon": true,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "",
        "connectionDelay": false,
        "cacheJson": false,
        "heartbeat": false,
        "heartbeatInterval": "",
        "statusSeparator": "",
        "enableGlobalContextStore": false
    },
    {
        "id": "e8210404c702f102",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Master Status",
        "version": "6",
        "entityType": "sensor",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Master Status"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": ""
            },
            {
                "property": "state_class",
                "value": ""
            }
        ],
        "resend": true,
        "debugEnabled": false
    },
    {
        "id": "7c14120a8388d81e",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Smoke Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Smoke Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 60
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "1c6f3be39e7ca801",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm CO Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm CO Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 60
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "7b5ce1638adcbcdf",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Home Entrry Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Home Entry Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 180
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "285334f7b18c773e",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Home Exit Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Home Exit Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 180
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "918c67579b1ada52",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Night Entry Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Night Entry Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 180
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "0db6bea9a4c8bf70",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Night Exit Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Night Exit Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 180
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "ee64fe6e3e8fc577",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Away Entry Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Away Entry Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 180
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "c735614284da7411",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Away Exit Delay",
        "version": "6",
        "entityType": "number",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Away Exit Delay"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            },
            {
                "property": "unit_of_measurement",
                "value": "seconds"
            },
            {
                "property": "min_value",
                "value": 0
            },
            {
                "property": "max_value",
                "value": 180
            },
            {
                "property": "step_value",
                "value": 1
            },
            {
                "property": "mode",
                "value": "slider"
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "50199663477f393a",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Local Users",
        "version": "6",
        "entityType": "text",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Local Users"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "mode",
                "value": "text"
            },
            {
                "property": "min_length",
                "value": ""
            },
            {
                "property": "max_length",
                "value": ""
            },
            {
                "property": "pattern",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "bca80de0dba5a445",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Keymaster Door Name",
        "version": "6",
        "entityType": "text",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Keymaster Door Name"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "mode",
                "value": "text"
            },
            {
                "property": "min_length",
                "value": ""
            },
            {
                "property": "max_length",
                "value": ""
            },
            {
                "property": "pattern",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "62e8e338d0addd98",
        "type": "ha-entity-config",
        "server": "cc16ce7d.d93d8",
        "deviceConfig": "",
        "name": "Alarm Manual Trigger User Processing",
        "version": "6",
        "entityType": "button",
        "haConfig": [
            {
                "property": "name",
                "value": "Alarm Manual Trigger User Processing"
            },
            {
                "property": "icon",
                "value": "mdi:security"
            },
            {
                "property": "entity_picture",
                "value": ""
            },
            {
                "property": "entity_category",
                "value": ""
            },
            {
                "property": "device_class",
                "value": ""
            }
        ],
        "resend": false,
        "debugEnabled": false
    },
    {
        "id": "a08d6691789c99bb",
        "type": "global-config",
        "env": [],
        "modules": {
            "node-red-contrib-home-assistant-websocket": "0.80.3",
            "node-red-contrib-loop": "1.0.1",
            "node-red-contrib-looptimer": "0.0.8",
            "node-red-contrib-image-tools": "2.1.1"
        }
    }
]
